<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Amalin App - Dark Alerts</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts: Plus Jakarta Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- External Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <style>
    /* --- CONFIG TEMA --- */
    :root {
      --primary-purple: #a855f7;
      --primary-green: #10b981;
      --genz-gradient: linear-gradient(135deg, #9333ea 0%, #d8b4fe 100%);
      --bg-dark: #020617;
      --card-bg: rgba(30, 27, 75, 0.75);
      --text-main: #f8fafc;
      --text-dim: #94a3b8;
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-main);
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
      touch-action: manipulation;
    }

    .swal2-container { z-index: 20000 !important; }
    /* SweetAlert Input Dark Theme */
    .swal2-input { color: #fff !important; background: #1e293b !important; border-color: #475569 !important; }
    ::-webkit-scrollbar { width: 0px; background: transparent; }

    /* --- GLASSMORPHISM AUTH --- */
    .blob { position: absolute; filter: blur(80px); z-index: -1; opacity: 0.6; animation: float 10s infinite alternate ease-in-out; }
    .blob-one { top: -10%; left: -10%; width: 300px; height: 300px; background: #7c3aed; border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
    .blob-two { bottom: -10%; right: -10%; width: 350px; height: 350px; background: #059669; border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; animation-delay: -5s; }
    @keyframes float { 0% { transform: translate(0, 0) rotate(0deg); } 100% { transform: translate(30px, 50px) rotate(20deg); } }
    .glass-panel { background: rgba(17, 25, 40, 0.7); backdrop-filter: blur(16px) saturate(180%); -webkit-backdrop-filter: blur(16px) saturate(180%); border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.125); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
    .input-modern { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; color: white; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); font-weight: 500; backdrop-filter: blur(4px); }
    .input-modern:focus { border-color: var(--primary-purple); background: rgba(168, 85, 247, 0.05); box-shadow: 0 0 0 4px rgba(168, 85, 247, 0.1); outline: none; }

    /* --- COMPONENTS --- */
    .glass-card { background: var(--card-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1.25rem; box-shadow: 0 4px 20px -5px rgba(0,0,0,0.3); }
    .app-card { border-radius: 1.25rem; padding: 1rem; transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1); }
    .gradient-text { background: var(--genz-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
    .habit-item { display: flex; align-items: center; padding: 1rem; border-radius: 1rem; background: #1e1b4b; margin-bottom: 0.75rem; border: 1px solid rgba(255,255,255,0.05); transition: all 0.2s; cursor: pointer; min-height: 60px; }
    .habit-item:active { transform: scale(0.98); background: rgba(30, 27, 75, 0.9); }
    .habit-item.completed { background: #064e3b; border-color: var(--primary-green); }
    .bottom-nav { position: fixed; bottom: 1.25rem; left: 1rem; right: 1rem; max-width: 480px; margin: 0 auto; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 1.5rem; display: flex; justify-content: space-around; align-items: center; padding: 0.75rem 0.5rem; z-index: 1000; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px -5px rgba(0,0,0,0.5); }
    .nav-btn { color: #64748b; display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 0.65rem; font-weight: 600; flex: 1; transition: all 0.2s; padding: 4px 0; }
    .nav-btn.active { color: var(--primary-purple); transform: translateY(-2px); }
    .section { display: none; padding-bottom: 7rem; }
    .section.active { display: block; animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .progress-table-container { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; border-radius: 1rem; background: #0f172a; padding-bottom: 5px; }
    .progress-table { width: 100%; min-width: 380px; border-collapse: collapse; table-layout: fixed; }
    .progress-table th { padding: 0.8rem 0.25rem; font-size: 0.55rem; color: var(--text-dim); text-transform: uppercase; border-bottom: 1px solid rgba(255, 255, 255, 0.05); text-align: center; font-weight: 700; }
    .progress-table td { padding: 0.7rem 0.25rem; text-align: center; border-bottom: 1px solid rgba(255, 255, 255, 0.03); }
    .check-box { width: 26px; height: 26px; border-radius: 8px; border: 2px solid #334155; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
    .check-box.checked { background: var(--primary-green); border-color: var(--primary-green); color: white; }
    .card-select { background-color: #020617 !important; color: #ffffff !important; border: 2px solid var(--primary-purple) !important; font-weight: 700 !important; outline: none; padding: 0.75rem 1rem; border-radius: 1rem; appearance: none; text-align: center; width: 100%; font-size: 0.9rem; }
    .mini-card-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
    .stat-card { padding: 1rem; border-radius: 1.25rem; display: flex; flex-direction: column; justify-content: space-between; min-height: 110px; }
    .stat-label { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; color: var(--text-dim); letter-spacing: 0.05em; }
    .stat-value { font-size: 1.25rem; font-weight: 800; color: #fff; line-height: 1.2; }
    .prayer-times-scroll { display: flex; justify-content: space-between; gap: 0.5rem; overflow-x: auto; padding-bottom: 0.5rem; -webkit-overflow-scrolling: touch; }
    .prayer-time-item { flex: 1; min-width: 60px; text-align: center; padding: 0.5rem 0.25rem; border-radius: 0.75rem; background: rgba(255, 255, 255, 0.03); }
    .prayer-label { font-size: 0.55rem; font-weight: 700; text-transform: uppercase; color: var(--text-dim); margin-bottom: 2px; }
    .prayer-time { font-size: 0.8rem; font-weight: 800; color: #fff; }
    .mood-btn { font-size: 1.75rem; padding: 0.75rem; border-radius: 1rem; border: 2px solid transparent; transition: all 0.2s; cursor: pointer; background: rgba(255,255,255,0.03); }
    .mood-btn.active { background: rgba(168, 85, 247, 0.2); border-color: var(--primary-purple); transform: scale(1.05); }
    .mini-progress-bg { width: 100%; height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; margin-top: 8px; }
    .mini-progress-bar { height: 100%; border-radius: 10px; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
    .planner-card { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); border-radius: 1.5rem; padding: 1.5rem; }
    .range-slider { -webkit-appearance: none; width: 100%; height: 6px; border-radius: 10px; background: rgba(255, 255, 255, 0.15); outline: none; margin: 1rem 0; }
    .range-slider::-webkit-slider-thumb { appearance: none; width: 24px; height: 24px; border-radius: 50%; background: var(--primary-purple); cursor: pointer; box-shadow: 0 0 15px rgba(168, 85, 247, 0.6); transition: transform 0.1s; }
    .range-slider::-webkit-slider-thumb:active { transform: scale(1.2); }
    .input-field { background: #1e1b4b; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1rem; padding: 1rem; font-size: 0.95rem; color: white; outline: none; width: 100%; transition: border-color 0.2s; }
    .input-field:focus { border-color: var(--primary-purple); }
    .btn-primary { background: var(--primary-purple); color: white; padding: 1rem; border-radius: 1rem; font-weight: 700; font-size: 0.85rem; text-transform: uppercase; width: 100%; border: none; cursor: pointer; letter-spacing: 0.05em; transition: transform 0.1s; box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3); }
    .btn-primary:active { transform: scale(0.97); box-shadow: 0 2px 10px rgba(168, 85, 247, 0.2); }
    .profile-avatar { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary-purple); }
    .report-log-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; text-align: center; }
    .report-tab-btn { transition: all 0.3s ease; border-radius: 0.75rem; color: #94a3b8; font-weight: 700; font-size: 0.75rem; }
    .report-tab-btn.active { background: var(--primary-purple); color: white !important; shadow: 0 2px 10px rgba(168,85,247,0.3); }
    .step-badge { width: 22px; height: 22px; border-radius: 50%; background: var(--primary-purple); color: white; display: inline-flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 800; margin-right: 8px; flex-shrink: 0; }
    .deco-circle { position: absolute; z-index: -1; filter: blur(90px); border-radius: 50%; opacity: 0.15; pointer-events: none; }
    .juz-tile { background: #1e1b4b; border: 1px solid rgba(255,255,255,0.05); border-radius: 1rem; padding: 0.85rem; display: flex; align-items: center; gap: 0.85rem; transition: all 0.2s; cursor: pointer; min-height: 64px; }
    .juz-tile:active { transform: scale(0.97); background: rgba(30, 27, 75, 0.9); }
    .juz-checkbox { width: 28px; height: 28px; border-radius: 50%; border: 2.5px solid #475569; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; }
    .juz-tile.checked .juz-checkbox { background: var(--primary-green); border-color: var(--primary-green); color: white; }
    .juz-tile.checked .juz-text { color: white; font-weight: 700; }
    .juz-text { font-size: 0.85rem; color: #94a3b8; font-weight: 500; }
    .quran-tab-btn { position: relative; padding-bottom: 0.85rem; color: var(--text-dim); font-weight: 600; font-size: 0.75rem; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.05em; white-space: nowrap; }
    .quran-tab-btn.active { color: var(--primary-purple); font-weight: 800; }
    .quran-tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 10%; width: 80%; height: 4px; background: var(--primary-purple); border-radius: 4px 4px 0 0; box-shadow: 0 -2px 10px var(--primary-purple); }
    .manual-select { background-color: #1e1b4b; color: white; border: 1px solid rgba(255,255,255,0.1); padding: 0.85rem 1rem; border-radius: 1rem; width: 100%; outline: none; font-size: 0.9rem; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; }
    .manual-select option { background-color: #020617; color: white; padding: 10px; }
    .dua-card-list { background: var(--card-bg); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1.25rem; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 4px 15px -3px rgba(0,0,0,0.2); position: relative; overflow: hidden; }
    .dua-card-list::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background: var(--primary-purple); border-radius: 4px 0 0 4px; }
    .adzan-toggle { width: 36px; height: 20px; background: #334155; border-radius: 20px; position: relative; cursor: pointer; transition: background 0.3s; }
    .adzan-toggle.active { background: var(--primary-purple); }
    .adzan-toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background: white; border-radius: 50%; transition: transform 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
    .adzan-toggle.active::after { transform: translateX(16px); }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
    .modal-overlay.active { display: flex; animation: fadeIn 0.2s; }
    .modal-content { background: #1e1b4b; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 380px; border-radius: 1.5rem; padding: 1.5rem; box-shadow: 0 10px 40px rgba(0,0,0,0.5); transform: scale(0.95); opacity: 0; transition: all 0.3s; }
    .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }
    .dua-tab-btn { position: relative; padding-bottom: 0.85rem; color: var(--text-dim); font-weight: 600; font-size: 0.75rem; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.05em; white-space: nowrap; flex: 1; text-align: center; }
    .dua-tab-btn.active { color: var(--primary-green); font-weight: 800; }
    .dua-tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 15%; width: 70%; height: 4px; background: var(--primary-green); border-radius: 4px 4px 0 0; box-shadow: 0 -2px 10px var(--primary-green); }

    /* --- SHARE CARD CANVAS STYLES --- */
    #share-card-wrapper { position: fixed; top: -9999px; left: -9999px; pointer-events: none; }
    .share-card-canvas {
        width: 360px; height: 640px; 
        background: linear-gradient(135deg, #1e1b4b 0%, #020617 100%);
        padding: 24px; color: white; display: flex; flex-direction: column; 
        font-family: 'Plus Jakarta Sans', sans-serif; position: relative; overflow: hidden;
    }
    .sc-blob { position: absolute; filter: blur(60px); z-index: 1; opacity: 0.5; }
    .sc-blob-1 { width: 220px; height: 220px; background: #a855f7; top: -60px; left: -60px; border-radius: 50%; }
    .sc-blob-2 { width: 280px; height: 280px; background: #10b981; bottom: -80px; right: -80px; border-radius: 50%; }
    .sc-content { position: relative; z-index: 20; height: 100%; display: flex; flex-direction: column; gap: 1rem; }
    .sc-item { 
        background: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255,255,255,0.15); 
        border-radius: 16px; padding: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    .sc-item-title { font-size: 10px; font-weight: 800; text-transform: uppercase; color: #c084fc; margin-bottom: 8px; letter-spacing: 0.05em; }
    .sc-check-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; }
    .sc-check-label { font-size: 12px; font-weight: 600; color: #e2e8f0; }
    .sc-check-icon { font-size: 12px; }
  </style>
</head>
<body class="pb-32 text-white">

  <!-- AUTH SCREEN -->
  <div id="auth-screen" class="fixed inset-0 z-[2000] bg-[#020617] flex items-center justify-center p-4 overflow-hidden">
    <div class="blob blob-one"></div><div class="blob blob-two"></div>
    <div class="glass-panel w-full max-w-sm p-8 relative z-10 flex flex-col items-center text-center space-y-6">
        <div class="space-y-2 mb-2">
            <div class="text-6xl animate-bounce mb-2">ğŸŒ™</div>
            <h1 class="text-4xl font-extrabold tracking-tighter uppercase leading-none drop-shadow-2xl" style="font-family: 'Poppins', sans-serif;">
              <span class="text-white" style="-webkit-text-stroke: 6px var(--primary-purple); paint-order: stroke fill;">Amalin</span><span class="text-pink-500" style="-webkit-text-stroke: 6px white; paint-order: stroke fill;">App</span>
            </h1>
            <p class="text-slate-300 text-xs font-bold uppercase tracking-[0.2em] mt-2">Niatin, Jalanin, Konsisten</p>
        </div>
        <div class="w-full space-y-4">
            <div id="auth-form-container" class="space-y-4">
                <div id="field-name-container" class="hidden opacity-0 transition-all duration-300">
                    <div class="relative group"><div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 group-focus-within:text-purple-400 transition-colors"><i data-lucide="user" class="w-5 h-5"></i></div><input type="text" id="auth-name" class="input-modern w-full py-4 pl-12 pr-4 text-sm" placeholder="Nama Panggilan"></div>
                </div>
                <div class="relative group"><div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 group-focus-within:text-purple-400 transition-colors"><i data-lucide="mail" class="w-5 h-5"></i></div><input type="email" id="auth-email" class="input-modern w-full py-4 pl-12 pr-4 text-sm" placeholder="Email Kamu"></div>
                <div class="relative group"><div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 group-focus-within:text-purple-400 transition-colors"><i data-lucide="lock" class="w-5 h-5"></i></div><input type="password" id="auth-pass" class="input-modern w-full py-4 pl-12 pr-12 text-sm" placeholder="Password"><button type="button" onclick="togglePasswordVisibility('auth-pass', this)" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-white p-1 rounded-full transition-colors"><i data-lucide="eye" class="w-5 h-5"></i></button></div>
                <button id="btn-auth-action" onclick="handleAuthAction()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold py-4 rounded-2xl shadow-lg shadow-purple-900/40 transition-all active:scale-95 flex items-center justify-center gap-2 mt-2"><span id="btn-text">MASUK SEKARANG</span><i data-lucide="arrow-right" class="w-4 h-4"></i></button>
            </div>
            <div class="pt-4 border-t border-white/10"><p id="auth-footer-text" class="text-xs text-slate-400 mb-2">Belum punya akun?</p><button onclick="toggleAuthMode()" id="auth-switch-btn" class="text-xs font-extrabold text-purple-300 hover:text-white uppercase tracking-widest transition-colors py-2 px-4 rounded-lg hover:bg-white/5">Daftar Akun Baru</button></div>
        </div>
    </div>
  </div>

  <!-- HIDDEN CARD TEMPLATE -->
  <div id="share-card-wrapper">
      <div id="share-card-template" class="share-card-canvas">
          <div class="sc-blob sc-blob-1"></div><div class="sc-blob sc-blob-2"></div>
          <div class="sc-content">
              <div class="text-center mt-2 z-20">
                  <p class="text-[10px] font-bold tracking-[0.2em] uppercase text-white/80 mb-1" id="sc-date-label">REPORT</p>
                  <h1 class="text-3xl font-black italic tracking-tighter uppercase leading-none text-white drop-shadow-lg" id="sc-main-title">Ramadhan<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-emerald-400">Activity</span></h1>
                  <p class="text-[12px] font-bold text-slate-300 mt-1" id="sc-user-name">User</p>
              </div>
              <div class="flex-1 flex flex-col justify-center gap-4 z-20">
                <div id="sc-activity-section" class="sc-item"><p class="sc-item-title">Checklist</p><div id="sc-activity-list" class="space-y-1.5"></div></div>
                <div class="sc-item border-l-4 border-l-emerald-500"><div class="flex justify-between items-end"><div><p class="sc-item-title !text-emerald-400 !mb-1">Quran Progress</p><p class="text-lg font-black text-white" id="sc-quran-status">Juz 1 Completed</p></div><i data-lucide="book-open" class="w-6 h-6 text-emerald-400"></i></div></div>
                <div id="sc-goals-section" class="sc-item hidden"><p class="sc-item-title !text-blue-400">Top Goals</p><div id="sc-goals-list" class="space-y-2"></div></div>
              </div>
              <div class="mt-auto z-20">
                  <div class="text-center px-4 mb-4"><p class="text-[10px] italic font-medium text-slate-200 leading-relaxed drop-shadow-md" id="sc-quote">"Quote..."</p></div>
                  <div class="flex justify-center items-center gap-2 opacity-80"><div class="w-6 h-6 bg-purple-600 rounded-lg flex items-center justify-center text-[10px]">ğŸŒ™</div><span class="text-[10px] font-bold tracking-widest uppercase">Amalin App</span></div>
              </div>
          </div>
      </div>
  </div>

  <!-- MAIN APP STRUCTURE -->
  <div id="main-app" class="hidden max-w-md mx-auto relative min-h-screen">
    <header class="p-6 pt-8 flex justify-between items-center relative z-40">
      <div class="space-y-1">
        <p class="text-[10px] font-black text-slate-500 uppercase tracking-wide" id="header-masehi-date">--:--</p>
        <p class="text-xs font-black text-emerald-500 uppercase tracking-wide" id="header-hijri-date">1 RAMADHAN 1447 H</p>
        <h2 id="greeting-text" class="text-2xl font-extrabold text-white leading-tight mt-1">Assalamu'alaikum, <br><span id="user-name-display" class="gradient-text text-3xl">Akhi</span></h2>
      </div>
    </header>

    <main class="px-6 pb-32">
        <!-- TAB HOME -->
        <section id="tab-home" class="section active space-y-6">
            <div class="app-card bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 text-white relative overflow-hidden shadow-2xl shadow-purple-900/30 flex flex-col justify-between min-h-[200px]">
                <div class="relative z-10 flex justify-between items-start">
                    <div><p class="text-[10px] font-black uppercase opacity-70 mb-1 tracking-widest">Ramadhan Kariim</p><h3 id="card-hijri-display" class="text-2xl font-black italic tracking-tighter">1 RAMADHAN 1447 H</h3></div>
                    <div class="text-right"><p id="countdown-label" class="text-[9px] font-black uppercase opacity-70 mb-0.5 tracking-wide">DETEKSI...</p><p id="countdown-timer" class="text-lg font-black tracking-tighter tabular-nums">00:00:00</p></div>
                </div>
                <div class="relative z-10 my-4"><p id="daily-inspiration-text" class="inspiration-text italic text-sm font-medium leading-relaxed opacity-90">...</p></div>
                <div class="relative z-10"><select id="home-date-filter" class="input-field card-select py-3 text-sm font-bold shadow-lg" onchange="changeActiveDay(this.value)"></select></div>
            </div>
            
            <div class="glass-card p-4 flex items-center gap-4 border-l-4 border-l-purple-500 shadow-lg">
                <div class="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center flex-shrink-0"><i data-lucide="sparkles" class="w-5 h-5 text-purple-400 animate-pulse"></i></div>
                <div class="flex-1"><p class="text-[9px] font-black uppercase text-purple-300 tracking-widest mb-0.5">Smart Imsakiyah (AI)</p><p id="smart-suhoor-text" class="text-xs font-bold text-white leading-snug">Menghitung...</p></div>
            </div>

            <div class="glass-card p-5 space-y-4">
               <div class="flex justify-between items-center border-b border-white/10 pb-3 mb-1">
                    <div class="flex flex-col"><div class="flex items-center gap-2"><div class="p-1.5 bg-purple-500/20 rounded-lg"><i data-lucide="map-pin" class="w-3.5 h-3.5 text-purple-400"></i></div><span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Jadwal Sholat</span></div><span id="current-location-display" class="text-[9px] font-bold text-purple-300 uppercase truncate max-w-[180px] mt-1 ml-1">Mendeteksi Lokasi...</span></div>
                    <div class="flex items-center gap-3"><div id="btn-refresh-location" onclick="detectLocation()" class="cursor-pointer w-8 h-8 flex items-center justify-center bg-purple-600/20 rounded-full border border-purple-500/30 active:scale-90 transition-transform"><i data-lucide="refresh-cw" class="w-3.5 h-3.5 text-purple-400"></i></div></div>
                </div>
                <div class="prayer-times-scroll">
                    <div class="prayer-time-item"><p class="prayer-label">Subuh</p><p class="prayer-time" id="time-fajr">--:--</p></div>
                    <div class="prayer-time-item"><p class="prayer-label">Dzhur</p><p class="prayer-time" id="time-dhuhr-val">--:--</p></div>
                    <div class="prayer-time-item"><p class="prayer-label">Ashar</p><p class="prayer-time" id="time-asr">--:--</p></div>
                    <div class="prayer-time-item"><p class="prayer-label">Mghrb</p><p class="prayer-time" id="time-maghrib">--:--</p></div>
                    <div class="prayer-time-item"><p class="prayer-label">Isya</p><p class="prayer-time" id="time-isha">--:--</p></div>
                </div>
            </div>
            
            <div id="habit-container" class="space-y-4 pb-4"></div>
        </section>

        <!-- TAB PROGRESS -->
        <section id="tab-progress" class="section space-y-6">
             <div class="flex border-b border-white/10 mb-4 px-2 overflow-x-auto no-scrollbar"><button id="btn-quran-juz" onclick="switchQuranTab('juz')" class="quran-tab-btn active flex-1">1 Day 1 Juz</button><button id="btn-quran-page" onclick="switchQuranTab('page')" class="quran-tab-btn flex-1">2 Lembar</button><button id="btn-quran-manual" onclick="switchQuranTab('manual')" class="quran-tab-btn flex-1">Manual</button></div>
             
             <!-- Juz View -->
             <div id="view-quran-juz" class="space-y-5">
                 <div class="glass-card p-6 relative overflow-hidden border border-white/10 shadow-xl">
                   <div class="flex justify-between items-end mb-4">
                      <div>
                         <div class="flex items-center gap-2 mb-2">
                             <div class="p-2 bg-purple-500/20 rounded-xl"><i data-lucide="bookmark" class="w-4 h-4 text-purple-400"></i></div>
                             <h4 class="text-sm font-black uppercase text-white tracking-tight">Progress Khatam</h4>
                         </div>
                         <p class="text-xs text-slate-400 font-bold uppercase tracking-widest pl-1"><span id="juz-completed-count" class="text-white">0</span> of 30 Juz</p>
                      </div>
                      <h2 class="text-4xl font-black gradient-text leading-none" id="juz-progress-percent">0%</h2>
                   </div>
                   <div class="bg-slate-800 h-3 rounded-full overflow-hidden border border-white/5">
                      <div id="juz-progress-bar" class="bg-gradient-to-r from-purple-500 to-emerald-400 h-full transition-all duration-700 shadow-[0_0_15px_rgba(168,85,247,0.5)]" style="width: 0%"></div>
                   </div>
                </div>
                <!-- Reset Button for Juz (Restored) -->
                <div class="flex justify-between items-center px-1 mb-2">
                    <h3 class="text-lg font-black uppercase text-white tracking-tighter">30 Juz Checklist</h3>
                    <button onclick="resetJuzProgress()" class="bg-red-500/10 text-red-400 p-2.5 rounded-xl border border-red-500/20 hover:bg-red-500 hover:text-white transition-all shadow-lg active:scale-95">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    </button>
                </div>
                 <div id="juz-list-container" class="grid grid-cols-2 gap-3 pb-8"></div>
             </div>
             
             <!-- Page View -->
             <div id="view-quran-page" class="hidden space-y-5">
                <div class="app-card glass-card relative overflow-hidden border border-white/10 p-6 text-center">
                    <div class="relative z-10 flex flex-col gap-6">
                        <div class="flex justify-between items-center"><div class="flex items-center gap-3"><div class="p-2 bg-emerald-500/20 rounded-xl"><i data-lucide="book-open" class="w-5 h-5 text-emerald-400"></i></div><p class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Total Progress</p></div><div class="bg-indigo-500/20 px-3 py-1.5 rounded-full border border-indigo-500/30"><p class="text-[9px] font-black text-indigo-300 uppercase" id="remaining-pages-label">SISA 604 Hal</p></div></div>
                        <div class="flex justify-between items-end"><div class="flex items-baseline gap-1"><h4 class="text-5xl font-black text-white tracking-tighter" id="total-page-count">0</h4><span class="text-sm font-black text-slate-500 uppercase ml-1">/ 604</span></div><span class="text-emerald-400 font-black text-3xl" id="total-page-percent">0%</span></div>
                        <div class="mini-progress-bg h-3 bg-slate-800 rounded-full overflow-hidden"><div id="total-page-bar" class="mini-progress-bar bg-gradient-to-r from-purple-500 to-emerald-400 h-full transition-all duration-1000" style="width: 0%"></div></div>
                    </div>
                </div>
                <div class="planner-card space-y-5">
                    <div class="flex justify-between items-center"><label class="text-[10px] font-black uppercase text-purple-300 tracking-widest">Target Khatam (Maks 10x)</label><span id="khatam-target-val" class="text-xl font-black italic text-white">1 Kali</span></div>
                    <input type="range" id="khatam-range" min="1" max="10" step="1" value="1" class="range-slider" oninput="handleQuranPlannerSlider(this.value)">
                    <div class="grid grid-cols-2 gap-3 text-center"><div class="bg-black/30 p-4 rounded-2xl"><p class="text-[9px] font-black text-slate-400 uppercase mb-1">Target Harian</p><p id="target-pages-day" class="text-lg font-black text-emerald-400">20 Halaman</p></div><div class="bg-black/30 p-4 rounded-2xl"><p class="text-[9px] font-black text-slate-400 uppercase mb-1">Per Sholat</p><p id="target-pages-prayer" class="text-lg font-black text-purple-400">4 Halaman</p></div></div>
                </div>
                <!-- Reset Button for Page (Restored) -->
                 <div class="flex justify-between items-center px-1 mb-1 mt-4">
                    <h3 class="text-lg font-black uppercase text-white tracking-tighter">Capaian Halaman</h3>
                    <button onclick="resetPageProgress()" class="bg-red-500/10 text-red-400 p-2.5 rounded-xl border border-red-500/20 hover:bg-red-500 hover:text-white transition-all shadow-lg active:scale-95">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="progress-table-container no-scrollbar shadow-xl border border-white/5 pb-8"><table class="progress-table text-white"><thead><tr><th style="width:40px;">Tgl</th><th>Subuh</th><th>Dzhur</th><th>Ashar</th><th>Mghb</th><th>Isya</th></tr></thead><tbody id="progress-table-body"></tbody></table></div>
             </div>
             
             <!-- Manual View -->
             <div id="view-quran-manual" class="hidden space-y-6">
                <!-- Reset Button for Manual (Restored) -->
                <div class="flex justify-between items-center px-1 mb-2">
                    <h3 class="text-lg font-black uppercase text-white tracking-tighter">Catatan Bacaan</h3>
                    <button onclick="resetManualLog()" class="bg-red-500/10 text-red-400 p-2.5 rounded-xl border border-red-500/20 hover:bg-red-500 hover:text-white transition-all shadow-lg active:scale-95">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    </button>
                </div>
                 <div class="glass-card p-6 space-y-5 border border-white/10 shadow-lg"><div class="space-y-2"><label class="text-[10px] uppercase font-bold text-slate-400 tracking-widest pl-1">Mulai</label><div class="flex gap-3"><select id="manual-surah-start" class="manual-select flex-[2] text-sm"></select><input type="number" id="manual-ayat-start" class="input-field flex-1 text-center font-bold" placeholder="Ayat"></div></div><div class="flex justify-center -my-2 text-slate-500"><i data-lucide="arrow-down" class="w-5 h-5"></i></div><div class="space-y-2"><label class="text-[10px] uppercase font-bold text-slate-400 tracking-widest pl-1">Sampai</label><div class="flex gap-3"><select id="manual-surah-end" class="manual-select flex-[2] text-sm"></select><input type="number" id="manual-ayat-end" class="input-field flex-1 text-center font-bold" placeholder="Ayat"></div></div><button onclick="saveManualEntry()" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-95 uppercase tracking-widest text-xs mt-2 flex items-center justify-center gap-2"><i data-lucide="save" class="w-4 h-4"></i> Simpan Catatan</button></div><div id="manual-log-list" class="space-y-3"></div></div>
        </section>

        <!-- TAB DOA -->
        <section id="tab-duas" class="section space-y-6">
            <h3 class="text-3xl font-black uppercase text-white text-center mb-6">Doa <span class="gradient-text">Ramadhan</span></h3>
            <div class="flex border-b border-white/10 mb-4 px-2 overflow-x-auto no-scrollbar">
                <button id="btn-dua-doa" onclick="switchDuaTab('doa')" class="dua-tab-btn active flex-1 min-w-[80px]">Doa Harian</button>
                <button id="btn-dua-niat" onclick="switchDuaTab('niat')" class="dua-tab-btn flex-1 min-w-[80px]">Niat</button>
                <button id="btn-dua-fiqih" onclick="switchDuaTab('fiqih')" class="dua-tab-btn flex-1 min-w-[80px]">Fiqih</button>
            </div>
            <div id="view-dua-doa" class="space-y-6"><div id="dua-list-container" class="space-y-5 pb-8 overflow-y-auto max-h-[70vh] no-scrollbar px-1"></div></div>
            <div id="view-dua-niat" class="hidden space-y-5 px-1 pb-8">
                 <div class="dua-card-list space-y-4">
                    <p class="text-[9px] font-black uppercase text-emerald-400 tracking-widest mb-1 text-white">Niat Puasa Ramadhan Besok (Harian)</p>
                    <p class="text-xl font-serif text-right text-white leading-loose">Ù†ÙÙˆÙÙŠÙ’ØªÙ ØµÙÙˆÙ’Ù…Ù ØºÙØ¯Ù Ø¹ÙÙ†Ù’ Ø£ÙØ¯ÙØ§Ø¡Ù ÙÙØ±Ù’Ø¶Ù Ø´ÙÙ‡Ù’Ø±Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ù‡ÙØ°ÙÙ‡Ù Ø§Ù„Ø³ÙÙ‘Ù†ÙØ©Ù Ù„ÙÙ„Ù‘Ù°Ù‡Ù ØªÙØ¹ÙØ§Ù„ÙÙ‰</p>
                    <p class="text-xs italic text-slate-400">Nawaitu shauma ghadin 'an ada'i fardhi syahri Ramadhana hadzihis sanati lillahi ta'ala</p>
                    <p class="text-sm font-bold text-emerald-400 leading-snug">"Aku berniat puasa esok hari untuk menunaikan fardhu di bulan Ramadhan tahun ini, karena Allah Ta'ala."</p>
                </div>
                <div class="dua-card-list space-y-4">
                    <p class="text-[9px] font-black uppercase text-emerald-400 tracking-widest mb-1 text-white">Niat Puasa Ramadhan 1 Bulan Penuh</p>
                    <p class="text-[10px] text-slate-400 italic mb-2">Dibaca di awal malam Ramadhan (biasanya malam 1).</p>
                    <p class="text-xl font-serif text-right text-white leading-loose">Ù†ÙÙˆÙÙŠÙ’ØªÙ ØµÙÙˆÙ’Ù…Ù Ø¬ÙÙ…ÙÙŠÙ’Ø¹Ù Ø´ÙÙ‡Ù’Ø±Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ù‡ÙØ°ÙÙ‡Ù Ø§Ù„Ø³ÙÙ‘Ù†ÙØ©Ù ØªÙÙ‚Ù’Ù„ÙÙŠÙ’Ø¯Ù‹Ø§ Ù„ÙÙ„Ù’Ø¥ÙÙ…ÙØ§Ù…Ù Ù…ÙØ§Ù„ÙÙƒÙ ÙÙØ±Ù’Ø¶Ù‹Ø§ Ù„ÙÙ„Ù‡Ù ØªÙØ¹ÙØ§Ù„ÙÙ‰</p>
                    <p class="text-xs italic text-slate-400">Nawaitu shauma jami'i shahri Ramadhani hadzihis-sanati taqlÄ«dan lil-ImÄmi MÄlik fardhan lillÄhi ta'ÄlÄ</p>
                    <p class="text-sm font-bold text-emerald-400 leading-snug">"Aku niat berpuasa di sepanjang bulan Ramadhan tahun ini dengan mengikuti Imam Malik, wajib karena Allah."</p>
                </div>
                <div class="dua-card-list space-y-4">
                    <p class="text-[9px] font-black uppercase text-purple-400 tracking-widest mb-1 text-white">Doa Berbuka Puasa</p>
                    <p class="text-xl font-serif text-right text-white leading-loose">Ø°ÙÙ‡ÙØ¨Ù Ø§Ù„Ø¸ÙÙ‘Ù…ÙØ£Ù ÙˆÙØ§Ø¨Ù’ØªÙÙ„ÙÙ‘ØªÙ Ø§Ù„Ù’Ø¹ÙØ±ÙÙˆÙ‚ÙØŒ ÙˆÙØ«ÙØ¨ÙØªÙ Ø§Ù„Ø£ÙØ¬Ù’Ø±Ù Ø¥ÙÙ†Ù’ Ø´ÙØ§Ø¡Ù Ø§Ù„Ù„Ù‡Ù</p>
                    <p class="text-xs italic text-slate-400">Dzahabadzh dzhama-u wabtallatil-'uruqu wa tsabatal-ajru insyaa-Allah</p>
                    <p class="text-sm font-bold text-emerald-400 leading-snug">"Telah hilang rasa haus, dan urat-urat telah basah serta pahala telah tetap, insya Allah."</p>
                </div>
                <div class="dua-card-list space-y-4">
                    <p class="text-[9px] font-black uppercase text-blue-400 tracking-widest mb-1 text-white">Niat Zakat Fitrah (Diri Sendiri)</p>
                    <p class="text-xl font-serif text-right text-white leading-loose">Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙÙ†Ù’ Ø£ÙØ®Ù’Ø±ÙØ¬Ù Ø²ÙÙƒÙØ§Ø©Ù Ø§Ù„Ù’ÙÙØ·Ù’Ø±Ù Ø¹ÙÙ†Ù’ Ù†ÙÙÙ’Ø³ÙÙŠÙ’ ÙÙØ±Ù’Ø¶Ù‹Ø§ Ù„ÙÙ„Ù‘Ù°Ù‡Ù ØªÙØ¹ÙØ§Ù„ÙÙ‰</p>
                    <p class="text-xs italic text-slate-400">Nawaitu an ukhrija zakaatal fithri 'an nafsii fardhan lillaahi ta'alaa</p>
                    <p class="text-sm font-bold text-emerald-400 leading-snug">"Aku niat mengeluarkan zakat fitrah untuk diriku sendiri, fardhu karena Allah Ta'ala."</p>
                </div>
                <div class="dua-card-list space-y-4">
                    <p class="text-[9px] font-black uppercase text-blue-400 tracking-widest mb-1 text-white">Niat Zakat Fitrah (Untuk Istri)</p>
                    <p class="text-xl font-serif text-right text-white leading-loose">Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙÙ†Ù’ Ø£ÙØ®Ù’Ø±ÙØ¬Ù Ø²ÙÙƒÙØ§Ø©Ù Ø§Ù„Ù’ÙÙØ·Ù’Ø±Ù Ø¹ÙÙ†Ù’ Ø²ÙÙˆÙ’Ø¬ÙØªÙÙŠÙ’ ÙÙØ±Ù’Ø¶Ù‹Ø§ Ù„ÙÙ„Ù‘Ù°Ù‡Ù ØªÙØ¹ÙØ§Ù„ÙÙ‰</p>
                    <p class="text-xs italic text-slate-400">Nawaitu an ukhrija zakaatal fithri 'an zaujatii fardhan lillaahi ta'alaa</p>
                    <p class="text-sm font-bold text-emerald-400 leading-snug">"Aku niat mengeluarkan zakat fitrah untuk istriku, fardhu karena Allah Ta'ala."</p>
                </div>
                 <div class="dua-card-list space-y-4">
                    <p class="text-[9px] font-black uppercase text-blue-400 tracking-widest mb-1 text-white">Niat Zakat Fitrah (Seluruh Keluarga)</p>
                    <p class="text-xl font-serif text-right text-white leading-loose">Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙÙ†Ù’ Ø£ÙØ®Ù’Ø±ÙØ¬Ù Ø²ÙÙƒÙØ§Ø©Ù Ø§Ù„Ù’ÙÙØ·Ù’Ø±Ù Ø¹ÙÙ†ÙÙ‘ÙŠÙ’ ÙˆÙØ¹ÙÙ†Ù’ Ø¬ÙÙ…ÙÙŠÙ’Ø¹Ù Ù…ÙØ§ ÙŠÙÙ„Ù’Ø²ÙÙ…ÙÙ†ÙÙŠÙ’ Ù†ÙÙÙÙ‚ÙØ§ØªÙÙ‡ÙÙ…Ù’ Ø´ÙØ±Ù’Ø¹Ù‹Ø§ ÙÙØ±Ù’Ø¶Ù‹Ø§ Ù„ÙÙ„Ù‘Ù°Ù‡Ù ØªÙØ¹ÙØ§Ù„ÙÙ‰</p>
                    <p class="text-xs italic text-slate-400">Nawaitu an ukhrija zakaatal fithri 'annii wa 'an jamii'i maa yalzamunii nafaqatuhum syar'an fardhan lillaahi ta'alaa</p>
                    <p class="text-sm font-bold text-emerald-400 leading-snug">"Aku niat mengeluarkan zakat fitrah untuk diriku dan seluruh orang yang nafkahnya menjadi tanggunganku, fardhu karena Allah Ta'ala."</p>
                </div>
            </div>
            <div id="view-dua-fiqih" class="hidden space-y-5 px-1 pb-8">
                 <div class="glass-card p-5 space-y-3"><h4 class="text-sm font-black uppercase text-purple-400 tracking-wide border-b border-white/10 pb-2">Rukun Puasa</h4><ul class="list-disc list-inside text-xs text-slate-300 space-y-2 leading-relaxed"><li><strong class="text-white">Niat:</strong> Dilakukan malam hari sebelum fajar.</li><li><strong class="text-white">Imssak:</strong> Menahan diri dari hal yang membatalkan puasa dari terbit fajar hingga terbenam matahari.</li></ul></div>
                 <div class="glass-card p-5 space-y-3"><h4 class="text-sm font-black uppercase text-emerald-400 tracking-wide border-b border-white/10 pb-2">Amalan Sunnah Rasul</h4><ul class="list-disc list-inside text-xs text-slate-300 space-y-2 leading-relaxed"><li>Mengakhirkan Sahur.</li><li>Menyegerakan Berbuka.</li><li>Berdoa saat berbuka.</li><li>Memberi makan orang berbuka.</li><li>Tadarus Al-Quran.</li></ul></div>
                 <div class="glass-card p-5 space-y-3"><h4 class="text-sm font-black uppercase text-red-400 tracking-wide border-b border-white/10 pb-2">Pembatal Puasa</h4><ul class="list-disc list-inside text-xs text-slate-300 space-y-2 leading-relaxed"><li>Makan/minum sengaja.</li><li>Muntah sengaja.</li><li>Berhubungan suami istri.</li><li>Haid/Nifas.</li><li>Hilang akal/Gila.</li></ul></div>
            </div>
        </section>

        <section id="tab-goals" class="section space-y-6"><div class="flex justify-between items-center px-1"><h3 class="text-3xl font-black uppercase text-white leading-tight">My Goals</h3><button onclick="addNewGoal()" class="w-12 h-12 bg-purple-600 rounded-2xl flex items-center justify-center text-white shadow-xl active:scale-90 transition-transform"><i data-lucide="plus" class="w-6 h-6"></i></button></div><div id="goals-list-container" class="space-y-5 pb-8"></div></section>

        <section id="tab-history" class="section space-y-6">
            <div class="flex justify-between items-center gap-4 px-1"><h3 class="text-3xl font-black uppercase text-white leading-tight">Rapor</h3><select id="report-day-filter" class="input-field card-select py-2 px-4 text-xs w-auto h-auto font-bold shadow-md" onchange="handleReportFilterChange(this.value)"></select></div>
            <div class="grid grid-cols-2 gap-3 mb-4">
              <button onclick="generateShareCard('daily')" class="bg-gradient-to-r from-pink-600 to-rose-600 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-all text-[10px] uppercase tracking-wide"><i data-lucide="share-2" class="w-3.5 h-3.5"></i><span>Kartu Harian</span></button>
              <button onclick="generateShareCard('monthly')" class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-all text-[10px] uppercase tracking-wide"><i data-lucide="bar-chart-2" class="w-3.5 h-3.5"></i><span>Rapor Bulanan</span></button>
            </div>
            <div class="flex bg-slate-900 p-1.5 rounded-2xl border border-white/5"><button id="btn-view-harian" onclick="switchReportView('harian')" class="report-tab-btn active flex-1 py-3">Harian</button><button id="btn-view-bulanan" onclick="switchReportView('bulanan')" class="report-tab-btn flex-1 py-3">Bulanan</button></div>
            <div id="report-harian-view" class="space-y-5"><div class="glass-card p-5"><canvas id="dailyChart" height="220"></canvas></div><div id="daily-log-container" class="space-y-4 pb-8"></div></div>
            <div id="report-bulanan-view" class="hidden space-y-5">
                <div class="glass-card p-5 mb-4"><canvas id="monthlyTrendChart" height="220"></canvas></div>
                <div class="mini-card-grid pb-8">
                    <div class="stat-card glass-card border-b-4 border-emerald-500"><p class="stat-label">Total Puasa</p><span class="stat-value" id="stat-total-puasa">0</span></div>
                    <div class="stat-card glass-card border-b-4 border-blue-400"><p class="stat-label">Khatam Progress</p><span class="stat-value" id="stat-total-khatam">0%</span></div>
                    <!-- Restored Stats -->
                    <div class="stat-card glass-card border-b-4 border-purple-500"><p class="stat-label">Efisiensi Ibadah</p><span class="stat-value" id="stat-avg-eff">0%</span></div>
                    <div class="stat-card glass-card border-b-4 border-orange-500"><p class="stat-label">Goals Tercapai</p><span class="stat-value" id="stat-goals-done">0</span></div>
                </div>
            </div>
        </section>

        <section id="tab-settings" class="section space-y-8">
            <h3 class="text-3xl font-black uppercase text-center text-white">App <span class="gradient-text">Setelan</span></h3>
            
            <div class="glass-card p-8 text-center space-y-5 relative text-white border border-white/10 shadow-xl mx-2"><div class="relative inline-block mx-auto"><img id="user-avatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Ramadhan" class="profile-avatar mx-auto shadow-2xl"><div class="absolute bottom-0 right-[-5px] bg-purple-600 p-2.5 rounded-full border-4 border-[#1e1b4b] cursor-pointer active:scale-90 transition-transform" onclick="changeAvatar()"><i data-lucide="camera" class="w-4 h-4 text-white"></i></div><input type="file" id="avatar-upload-input" class="hidden" accept="image/*" onchange="handleImageUpload(event)"></div><h4 id="profile-display-name-val" class="text-xl font-extrabold text-white tracking-tight">User</h4></div>
            
            <div class="space-y-3 px-2">
              <p class="text-[10px] font-black uppercase text-slate-400 pl-2 tracking-widest border-l-4 border-emerald-500 ml-1 pl-3">Daily Journal</p>
              <div class="glass-card p-6 space-y-5">
                  <div class="grid grid-cols-4 gap-4">
                      <button onclick="setMood('grateful')" class="mood-btn" id="mood-grateful">ğŸ˜‡</button>
                      <button onclick="setMood('happy')" class="mood-btn" id="mood-happy">ğŸ˜Š</button>
                      <button onclick="setMood('tired')" class="mood-btn" id="mood-tired">ğŸ˜´</button>
                      <button onclick="setMood('productive')" class="mood-btn" id="mood-productive">ğŸ”¥</button>
                  </div>
                  <textarea id="journal-input" class="input-field h-32 resize-none text-sm leading-relaxed" placeholder="Bagaimana perjalanan spiritualmu hari ini?"></textarea>
                  <button onclick="saveJournalEntry()" class="btn-primary py-3 text-xs bg-slate-800 hover:bg-slate-700">Simpan Jurnal</button>
              </div>
            </div>

            <div class="space-y-3 px-2">
              <p class="text-[10px] font-black uppercase text-slate-400 pl-2 tracking-widest border-l-4 border-blue-500 ml-1 pl-3">Akun & Data</p>
              <div class="glass-card p-5 space-y-4">
                  <input type="text" id="pref-name" class="input-field text-sm" placeholder="Ganti Username" oninput="checkSettingsChange()">
                  <button id="btn-save-settings" disabled onclick="saveAllSettings()" class="btn-primary py-3 text-xs bg-blue-600">Simpan Perubahan</button>
              </div>
            </div>

            <div class="space-y-3 px-2 pb-8">
              <p class="text-[10px] font-black uppercase text-slate-400 pl-2 tracking-widest border-l-4 border-indigo-500 ml-1 pl-3">Cloud Sync (GAS)</p>
              <div class="glass-card p-5 space-y-4 bg-indigo-950/20 border-indigo-500/20">
                  <div class="space-y-3 text-[10px] text-slate-300 font-medium text-left leading-relaxed">
                      <p><span class="step-badge">1</span> Siapkan Google Sheet.</p>
                      <p><span class="step-badge">2</span> Salin script backend.</p>
                      <p><span class="step-badge">3</span> Deploy Web App.</p>
                      <p><span class="step-badge">4</span> Masukkan URL.</p>
                  </div>
                  <button onclick="copyBackendScript()" class="btn-primary bg-slate-800 border border-indigo-500/30 flex items-center justify-center gap-2 text-[9px] py-3 hover:bg-slate-700"><i data-lucide="copy" class="w-3.5 h-3.5"></i><span>Salin Script Backend</span></button>
                  <input type="text" id="cfg-gs-url" class="input-field text-[10px] py-3" placeholder="URL Web App /exec" oninput="checkSettingsChange()">
                  <div class="grid grid-cols-2 gap-2">
                      <button onclick="saveCloudUrl()" class="btn-primary bg-indigo-600 text-[10px] py-3 hover:bg-indigo-500">Simpan URL</button>
                      <button onclick="testGASConnection()" class="btn-primary bg-slate-800 border border-indigo-500/20 text-[10px] py-3 hover:bg-slate-700">Test Koneksi</button>
                  </div>
                  <div class="grid grid-cols-2 gap-2 mt-2">
                      <button onclick="syncToCloud()" class="btn-primary bg-emerald-700 text-[10px] py-3 hover:bg-emerald-600 flex items-center justify-center gap-1"><i data-lucide="upload-cloud" class="w-3 h-3"></i> Upload Data</button>
                      <button onclick="syncFromCloud()" class="btn-primary bg-blue-700 text-[10px] py-3 hover:bg-blue-600 flex items-center justify-center gap-1"><i data-lucide="download-cloud" class="w-3 h-3"></i> Ambil Data</button>
                  </div>
              </div>
              <button onclick="doLogout()" class="w-full p-4 text-red-400 font-black text-xs border border-red-500/20 rounded-xl bg-red-500/5 hover:bg-red-500/10 uppercase tracking-widest flex items-center justify-center gap-2 mt-4 active:scale-95 transition-transform"><i data-lucide="log-out" class="w-4 h-4"></i> Keluar Akun</button>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
      <button onclick="navTo('home')" class="nav-btn active" id="btn-home"><i data-lucide="home"></i><span>Home</span></button>
      <button onclick="navTo('progress')" class="nav-btn" id="btn-progress"><i data-lucide="layout-grid"></i><span>Quran</span></button>
      <button onclick="navTo('duas')" class="nav-btn" id="btn-duas"><i data-lucide="book-heart"></i><span>Doa</span></button>
      <button onclick="navTo('goals')" class="nav-btn" id="btn-goals"><i data-lucide="target"></i><span>Target</span></button>
      <button onclick="navTo('history')" class="nav-btn" id="btn-history"><i data-lucide="bar-chart-2"></i><span>Rapor</span></button>
      <button onclick="navTo('settings')" class="nav-btn" id="btn-settings"><i data-lucide="settings"></i><span>Sistem</span></button>
    </nav>
  </div>

  <script>
    // --- VARIABLES & STATE ---
    const ramadhanQuotes = ["Puasa adalah perisai. (HR. Bukhari)", "Setiap amalan dilipatgandakan. (HR. Muslim)", "Bau mulut orang berpuasa harum di sisi Allah.", "Sedekah paling utama di Ramadhan.", "Dalam sahur terdapat keberkahan.", "Masuk Ramadhan, pintu surga dibuka.", "Beri buka puasa = pahala orang berpuasa.", "Ramadhan ke Ramadhan penghapus dosa.", "Dua kegembiraan bagi orang berpuasa.", "Sebaik-baik kalian belajar Al-Qur'an.", "Tuntutlah ilmu walau ke negeri Cina.", "Amalan kontinu dicintai Allah.", "Nikmat Tuhan mana yang didustakan?", "Sesudah kesulitan ada kemudahan.", "Tangan di atas lebih baik.", "Senyummu adalah sedekah.", "Manusia terbaik yang bermanfaat.", "Mencari ilmu dimudahkan jalan ke surga.", "Al-Qur'an adalah syafaat di hari kiamat.", "Bertakwalah di mana pun berada.", "Dunia adalah perhiasan sementara.", "Allah melihat hati dan amal kalian.", "Berkata baik atau diam.", "Cukuplah kematian sebagai nasihat.", "Kekayaan sejati adalah kekayaan jiwa.", "Surga di bawah telapak kaki ibu.", "Jaga waktu luang sebelum sibukmu.", "Sebaik-baik doa saat berpuasa.", "Puasalah kalian agar kalian sehat.", "Ya Allah, berkahilah Ramadhan kami."];
    
    // FULL DOA DATA
    const ramadhanDuas = [
        { day: 1, arabic: "Ø§ÙÙ„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§Ø¬Ù’Ø¹ÙÙ„Ù’ ØµÙÙŠÙØ§Ù…ÙÙŠÙ’ ÙÙÙŠÙ’Ù‡Ù ØµÙÙŠÙØ§Ù…Ù Ø§Ù„ØµÙÙ‘Ø§Ø¦ÙÙ…ÙÙŠÙ’Ù†ÙØŒ ÙˆÙÙ‚ÙÙŠÙØ§Ù…ÙÙŠÙ’ ÙÙÙŠÙ’Ù‡Ù Ù‚ÙÙŠÙØ§Ù…Ù Ø§Ù„Ù’Ù‚ÙØ§Ø¦ÙÙ…ÙÙŠÙ’Ù†ÙØŒ ÙˆÙÙ†ÙØ¨ÙÙ‘Ù‡Ù’Ù†ÙÙŠÙ’ ÙÙÙŠÙ’Ù‡Ù Ø¹ÙÙ†Ù’ Ù†ÙÙˆÙ’Ù…ÙØ©Ù Ø§Ù„Ù’ØºÙØ§ÙÙÙ„ÙÙŠÙ’Ù†ÙØŒ ÙˆÙÙ‡ÙØ¨Ù’ Ù„ÙÙŠÙ’ Ø¬ÙØ±Ù’Ù…ÙÙŠÙ’ ÙÙÙŠÙ’Ù‡Ù ÙŠÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ’Ù†ÙØŒ ÙˆÙØ§Ø¹Ù’ÙÙ Ø¹ÙÙ†ÙÙ‘ÙŠÙ’ ÙŠÙØ§ Ø¹ÙØ§ÙÙÙŠÙ‹Ø§ Ø¹ÙÙ†Ù Ø§Ù„Ù’Ù…ÙØ¬Ù’Ø±ÙÙ…ÙÙŠÙ’Ù†Ù", latin: "AllÃ¢hummajâ€™al shiyÃ¢mÃ® fÃ®hi shiyÃ¢mash shÃ¢imÃ®n, wa qiyÃ¢mÃ® fÃ®hi qiyÃ¢mal qÃ¢imÃ®n, wa nabbihnÃ® fÃ®hi â€˜an naumatil ghÃ¢filÃ®n, wa hab lÃ® jurmÃ® fÃ®hi yÃ¢ ilÃ¢hal â€˜Ã¢lamÃ®n, waâ€™fu â€˜annÃ® yÃ¢ â€˜Ã¢fiyan â€˜anil mujrimÃ®n.", meaning: "Ya Allah, jadikanlah puasaku di bulan ini seperti puasa orang-orang yang berpuasa dengan benar, shalat malamku seperti shalat malam orang-orang yang shalat malam dengan benar, dan bangunkanlah aku dari tidurnya orang-orang yang lalai. Hapuskanlah dosaku di bulan ini wahai Tuhan semesta alam, dan maafkanlah aku wahai Yang Maha Pemaaf bagi orang-orang yang berdosa." },
        { day: 2, arabic: "Ø§ÙÙ„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù‚ÙØ±ÙÙ‘Ø¨Ù’Ù†ÙÙŠÙ’ ÙÙÙŠÙ’Ù‡Ù Ø¥ÙÙ„ÙÙ‰ Ù…ÙØ±Ù’Ø¶ÙØ§ØªÙÙƒÙØŒ ÙˆÙØ¬ÙÙ†ÙÙ‘Ø¨Ù’Ù†ÙÙŠÙ’ ÙÙÙŠÙ’Ù‡Ù Ù…ÙÙ†Ù’ Ø³ÙØ®ÙØ·ÙÙƒÙ ÙˆÙÙ†ÙÙ‚ÙÙ…ÙØ§ØªÙÙƒÙØŒ ÙˆÙÙˆÙÙÙÙ‘Ù‚Ù’Ù†ÙÙŠÙ’ ÙÙÙŠÙ’Ù‡Ù Ù„ÙÙ‚ÙØ±ÙØ§Ø¡ÙØ©Ù Ø¢ÙŠÙØ§ØªÙÙƒÙØŒ Ø¨ÙØ±ÙØ­Ù’Ù…ÙØªÙÙƒÙ ÙŠÙØ§ Ø£ÙØ±Ù’Ø­ÙÙ…Ù Ø§Ù„Ø±ÙÙ‘Ø§Ø­ÙÙ…ÙÙŠÙ’Ù†Ù", latin: "AllÃ¢humma qarribnÃ® fÃ®hi ilÃ¢ mardhÃ¢tika, wa jannibnÃ® fÃ®hi min sakhatika wa naqimÃ¢tika, wa waffiqnÃ® fÃ®hi liqirÃ¢-ati Ã¢yÃ¢tika, birahmatika yÃ¢ arhamar rÃ¢himÃ®n.", meaning: "Ya Allah, dekatkanlah aku di bulan ini kepada keridhaan-Mu, jauhkanlah aku dari kemurkaan dan balasan-Mu, dan berilah aku taufik untuk membaca ayat-ayat-Mu, dengan rahmat-Mu wahai Yang Maha Pengasih dari semua yang pengasih." },
        // ... (Continuing the pattern for 30 days) ...
    ];
    // Populate placeholder for demo purpose to 30 days
    for(let i=ramadhanDuas.length+1; i<=30; i++) ramadhanDuas.push({ day: i, arabic: "...", latin: "...", meaning: "Doa hari ke-" + i });

    const SURAH_LIST = ["Al-Fatihah", "Al-Baqarah", "Ali 'Imran", "An-Nisa'", "Al-Ma'idah", "Al-An'am", "Al-A'raf", "Al-Anfal", "At-Taubah", "Yunus", "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra'", "Al-Kahf", "Maryam", "Ta-Ha", "Al-Anbiya'", "Al-Hajj", "Al-Mu'minun", "An-Nur", "Al-Furqan", "Asy-Syu'ara'", "An-Naml", "Al-Qasas", "Al-Ankabut", "Ar-Rum", "Luqman", "As-Sajdah", "Al-Ahzab", "Saba'", "Fatir", "Ya-Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir", "Fussilat", "Asy-Syura", "Az-Zukhruf", "Ad-Dukhan", "Al-Jasiyah", "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf", "Az-Zariyat", "At-Tur", "An-Najm", "Al-Qamar", "Ar-Rahman", "Al-Waqi'ah", "Al-Hadid", "Al-Mujadilah", "Al-Hasyr", "Al-Mumtahanah", "As-Saff", "Al-Jumu'ah", "Al-Munafiqun", "At-Taghabun", "At-Talaq", "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqah", "Al-Ma'arij", "Nuh", "Al-Jinn", "Al-Muzzammil", "Al-Muddassir", "Al-Qiyamah", "Al-Insan", "Al-Mursalat", "An-Naba'", "An-Nazi'at", "Abasa", "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Insyiqaq", "Al-Buruj", "At-Tariq", "Al-A'la", "Al-Ghasyiyah", "Al-Fajr", "Al-Balad", "Asy-Syams", "Al-Lail", "Ad-Duha", "Al-Insyirah", "At-Tin", "Al-Alaq", "Al-Qadr", "Al-Bayyinah", "Az-Zalzalah", "Al-Adiyat", "Al-Qari'ah", "At-Takasur", "Al-Asr", "Al-Humazah", "Al-Fil", "Quraisy", "Al-Ma'un", "Al-Kautsar", "Al-Kafirun", "An-Nasr", "Al-Lahab", "Al-Ikhlas", "Al-Falaq", "An-Nas"];
    
    const templateHabits = [{id:'sw1', name:'Subuh', category:'Shalat Wajib', icon:'zap', done:false},{id:'sw2', name:'Dzuhur', category:'Shalat Wajib', icon:'zap', done:false},{id:'sw3', name:'Ashar', category:'Shalat Wajib', icon:'zap', done:false},{id:'sw4', name:'Maghrib', category:'Shalat Wajib', icon:'zap', done:false},{id:'sw5', name:'Isya', category:'Shalat Wajib', icon:'zap', done:false},{id:'ss1', name:'Tahajud', category:'Sholat Sunnah', icon:'moon', done:false},{id:'ss2', name:'Dhuha', category:'Sholat Sunnah', icon:'sun', done:false},{id:'ss3', name:'Rawatib', category:'Sholat Sunnah', icon:'layers', done:false},{id:'ss4', name:'Witir', category:'Sholat Sunnah', icon:'sparkles', done:false},{id:'ss5', name:'Tarawih', category:'Sholat Sunnah', icon:'stars', done:false},{id:'rc1', name:'Baca Quran', category:'Ramadhan Challenger', icon:'book', done:false},{id:'rc2', name:'Dzikir', category:'Ramadhan Challenger', icon:'smile', done:false},{id:'rc3', name:'Sedekah', category:'Ramadhan Challenger', icon:'heart', done:false},{id:'rc4', name:'Sholawat', category:'Ramadhan Challenger', icon:'heart', done:false},{id:'rc5', name:'Sahur', category:'Ramadhan Challenger', icon:'sun', done:false}];

    let state = {
      user: null, activeDay: localStorage.getItem('ram_active_day') ? parseInt(localStorage.getItem('ram_active_day')) : 1,
      dailyHabits: JSON.parse(localStorage.getItem('ram_daily_habits')) || {}, goals: JSON.parse(localStorage.getItem('ram_custom_goals')) || [],
      journals: JSON.parse(localStorage.getItem('ram_journals')) || {}, 
      quranLog: JSON.parse(localStorage.getItem('khodim_quran_log_gz')) || Array(30).fill(null).map(() => Array(5).fill(false)),
      juzLog: JSON.parse(localStorage.getItem('ram_juz_log')) || Array(30).fill(false),
      manualLog: JSON.parse(localStorage.getItem('ram_manual_log')) || [],
      adzanSettings: JSON.parse(localStorage.getItem('ram_adzan_settings')) || { mode: 'beep', active: { Fajr: true, Dhuhr: true, Asr: true, Maghrib: true, Isha: true } },
      notifiedPrayers: [], chartValues: [50, 75, 60, 95, 85, 90, 0], profile: JSON.parse(localStorage.getItem('khodim_profile')) || { displayName: 'Akhi Ramadhan', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Ramadhan' },
      khatamTarget: localStorage.getItem('ram_khatam_target') ? parseInt(localStorage.getItem('ram_khatam_target')) : 1, prayerTimes: null, gsUrl: localStorage.getItem('khodim_gs_url') || '',
      remindersEnabled: localStorage.getItem('ram_reminders') !== 'false', authMode: 'login'
    };
    let dailyChart = null, monthlyTrendChart = null;

    // --- HELPER FUNCTIONS ---
    function saveDailyData() { localStorage.setItem('ram_daily_habits', JSON.stringify(state.dailyHabits)); localStorage.setItem('ram_custom_goals', JSON.stringify(state.goals)); localStorage.setItem('ram_journals', JSON.stringify(state.journals)); localStorage.setItem('khodim_quran_log_gz', JSON.stringify(state.quranLog)); localStorage.setItem('ram_juz_log', JSON.stringify(state.juzLog)); localStorage.setItem('ram_manual_log', JSON.stringify(state.manualLog)); localStorage.setItem('ram_adzan_settings', JSON.stringify(state.adzanSettings)); }
    function loadDailyData() { const h=localStorage.getItem('ram_daily_habits'); if(h) state.dailyHabits=JSON.parse(h); const g=localStorage.getItem('ram_custom_goals'); if(g) state.goals=JSON.parse(g); const j=localStorage.getItem('ram_journals'); if(j) state.journals=JSON.parse(j); const l=localStorage.getItem('khodim_quran_log_gz'); if(l) state.quranLog=JSON.parse(l); const jl=localStorage.getItem('ram_juz_log'); if(jl) state.juzLog=JSON.parse(jl); const ml=localStorage.getItem('ram_manual_log'); if(ml) state.manualLog=JSON.parse(ml); const as=localStorage.getItem('ram_adzan_settings'); if(as) state.adzanSettings=JSON.parse(as); }
    function formatNumber(n) { return n ? n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") : "0"; }
    function cleanNumber(s) { return s ? s.toString().replace(/\./g, "") : 0; }
    function parseTimeStr(ts) { if(!ts) return null; const [h, m] = ts.split(':').map(Number); const d = new Date(); d.setHours(h, m, 0, 0); return d; }
    
    // --- APP CORE & RENDERERS ---
    function initUser() { loadDailyData(); if(localStorage.getItem('khodim_active_session')) { state.user = JSON.parse(localStorage.getItem('khodim_active_session')); showApp(); } }
    function showApp() { document.getElementById('auth-screen').classList.add('hidden'); document.getElementById('main-app').classList.remove('hidden'); populateSurahDropdowns(); const hF=document.getElementById('home-date-filter'), rF=document.getElementById('report-day-filter'), uI=document.getElementById('cfg-gs-url'); if(uI) uI.value=state.gsUrl; if(hF){ hF.innerHTML=''; for(let i=1;i<=30;i++){const o=document.createElement('option');o.value=i;o.innerText=`Hari ke-${i}`;if(i===state.activeDay)o.selected=true;hF.appendChild(o);} } if(rF){ rF.innerHTML='<option value="all">Semua Hari</option>'; for(let i=1;i<=30;i++){const o=document.createElement('option');o.value=i;o.innerText=`Hari ${i}`;rF.appendChild(o);} } updateQuranPlanner(state.khatamTarget); renderHabits(); renderMonthlyTable(); renderGoals(); renderDuaList(); renderJournal(); renderManualLog(); updateUI(); updateDate(); detectLocation(); setTimeout(runBackgroundSystem, 2000); }
    
    function navTo(t) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        if (document.getElementById('tab-' + t)) document.getElementById('tab-' + t).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if (document.getElementById('btn-' + t)) document.getElementById('btn-' + t).classList.add('active');
        if (t === 'history') switchReportView('harian');
        if (t === 'progress') { renderMonthlyTable(); renderJuzList(); renderManualLog(); }
        if (t === 'goals') renderGoals();
        if (t === 'duas') renderDuaList();
        if (t === 'settings') renderJournal();
        lucide.createIcons();
    }
    
    function renderHabits() { const c=document.getElementById('habit-container'); if(!c) return; c.innerHTML=''; if(!state.dailyHabits[`day${state.activeDay}`]) state.dailyHabits[`day${state.activeDay}`] = JSON.parse(JSON.stringify(templateHabits)); const h=state.dailyHabits[`day${state.activeDay}`]; ['Shalat Wajib', 'Sholat Sunnah', 'Ramadhan Challenger'].forEach(cat => { const list = h.filter(x => x.category === cat); if(list.length === 0) return; const div = document.createElement('div'); div.className = 'space-y-3'; div.innerHTML = `<h4 class="text-[10px] font-black text-purple-400 uppercase tracking-widest pl-2 border-l-2 border-purple-500">${cat}</h4>`; list.forEach(x => { const idx = h.findIndex(item => item.id === x.id); const item = document.createElement('div'); item.className = `habit-item shadow-sm ${x.done ? 'completed' : ''}`; item.onclick = () => { h[idx].done = !h[idx].done; saveDailyData(); renderHabits(); updateUI(); }; item.innerHTML = `<div class="w-9 h-9 rounded-xl bg-indigo-900/40 flex items-center justify-center mr-3.5 shadow-sm"><i data-lucide="${x.icon}" class="w-5 h-5 text-purple-400"></i></div><div class="flex-1"><h4 class="text-xs font-extrabold text-white">${x.name}</h4></div><div class="w-6.5 h-6.5 rounded-lg border-2 border-slate-700 flex items-center justify-center transition-all ${x.done ? 'bg-emerald-500 border-emerald-500 text-white' : ''}">${x.done ? 'âœ”ï¸' : ''}</div>`; div.appendChild(item); }); c.appendChild(div); }); lucide.createIcons(); }
    function renderMonthlyTable() { const b=document.getElementById('progress-table-body'); if(!b) return; b.innerHTML=''; for(let i=0; i<30; i++) { const r=document.createElement('tr'); let c=`<td class="font-black text-slate-400 text-[10px] py-4 border-r border-white/5">${i+1}</td>`; for(let j=0; j<5; j++) { const chk=state.quranLog[i][j], k=(i*5)+j; const label = k===149?`${Math.floor(k*(604/150))+1}-604`:`${Math.floor(k*(604/150))+1}-${Math.floor((k+1)*(604/150))}`; c+=`<td><div class="flex flex-col items-center gap-1"><div class="check-box ${chk?'checked':''}" onclick="toggleQuranLog(${i}, ${j})">${chk?'<i data-lucide="check" class="w-3.5 h-3.5"></i>':''}</div><span class="text-[8px] font-bold text-slate-300">${label}</span></div></td>`; } r.innerHTML=c; b.appendChild(r); } lucide.createIcons(); }
    function renderDuaList() { const c=document.getElementById('dua-list-container'); if(!c) return; c.innerHTML=''; ramadhanDuas.forEach(d => { const div=document.createElement('div'); div.className='dua-card-list space-y-4'; div.innerHTML=`<p class="text-[9px] font-black uppercase text-purple-400 tracking-widest mb-1 text-white">Doa Hari Ke-${d.day}</p><p class="text-xl font-serif text-right text-white leading-loose">${d.arabic}</p><p class="text-xs italic text-slate-400">${d.latin}</p><p class="text-sm font-bold text-emerald-400 leading-snug">"${d.meaning}"</p>`; c.appendChild(div); }); }
    function renderGoals() { const c=document.getElementById('goals-list-container'); if(!c) return; c.innerHTML=''; state.goals.forEach((g,i)=>{ const p=Math.min(Math.round((g.current/g.target)*100),100); const div=document.createElement('div'); div.className='goal-card glass-card p-5 mb-4'; div.innerHTML=`<div class="flex justify-between items-start text-white"><div><h4 class="text-sm font-black uppercase tracking-wide">${g.title}</h4><p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">${formatNumber(g.current)} / ${formatNumber(g.target)} ${g.unit}</p></div><div class="flex gap-2"><button onclick="editGoal(${i})" class="text-purple-400 p-2 active:bg-purple-500/20 rounded-lg"><i data-lucide="edit-3" class="w-4 h-4"></i></button><button onclick="deleteGoal(${i})" class="text-red-500/50 p-2 active:bg-red-500/20 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div></div><div class="bg-black/30 h-3 rounded-full overflow-hidden mt-3"><div class="bg-gradient-to-r from-purple-500 to-emerald-400 h-full shadow-[0_0_10px_rgba(168,85,247,0.5)]" style="width:${p}%"></div></div><div class="flex justify-between items-center mt-4"><span class="text-xs font-black text-emerald-400">${p}%</span><div class="flex gap-3"><button onclick="updateGoalProgress(${i},-1)" class="w-10 h-10 rounded-xl bg-slate-800 text-white font-bold active:scale-90 transition-transform">-</button><button onclick="updateGoalProgress(${i},1)" class="w-10 h-10 rounded-xl bg-purple-600 text-white font-bold shadow-lg active:scale-90 transition-transform">+</button></div></div>`; c.appendChild(div); }); lucide.createIcons(); }
    
    function renderJournal() { 
        const entry = state.journals[`day${state.activeDay}`] || { mood: '', text: '' };
        const input = document.getElementById('journal-input');
        if (input) input.value = entry.text;
    }
    
    function renderManualLog() { const c=document.getElementById('manual-log-list'); if(!c) return; c.innerHTML=''; if(state.manualLog.length===0){ c.innerHTML='<p class="text-center text-xs text-slate-500 py-4 italic">Belum ada catatan.</p>'; return; } state.manualLog.forEach(item => { const div = document.createElement('div'); div.className = 'glass-card p-4 flex justify-between items-center border border-white/5 active:bg-slate-900 transition-colors'; div.innerHTML = `<div><div class="flex items-center gap-2 mb-1.5 flex-wrap"><span class="text-xs font-bold bg-purple-500/20 text-purple-300 px-2.5 py-1 rounded-lg">${item.startSurah}:${item.startAyat}</span><i data-lucide="arrow-right" class="w-3.5 h-3.5 text-slate-500"></i><span class="text-xs font-bold bg-emerald-500/20 text-emerald-300 px-2.5 py-1 rounded-lg">${item.endSurah}:${item.endAyat}</span></div><p class="text-[10px] text-slate-400 font-medium pl-1">${item.timestamp}</p></div><button onclick="deleteManualEntry(${item.id})" class="text-slate-500 hover:text-red-400 p-2"><i data-lucide="trash-2" class="w-4 h-4"></i></button>`; c.appendChild(div); }); lucide.createIcons(); }
    function renderJuzList() { 
        const c=document.getElementById('juz-list-container'); if(!c)return; c.innerHTML=''; 
        let completedCount = 0;
        state.juzLog.forEach((d,i)=>{ 
            if(d) completedCount++;
            const t=document.createElement('div'); t.className=`juz-tile ${d?'checked':''}`; t.onclick=()=>toggleJuz(i); t.innerHTML=`<div class="juz-checkbox">${d?'<i data-lucide="check" class="w-4 h-4 text-white"></i>':''}</div><span class="juz-text">Juz ${i+1}</span>`; c.appendChild(t); 
        }); 
        
        // Update Progress Bar in Quran Tab
        const pBar = document.getElementById('juz-progress-bar');
        const pTxt = document.getElementById('juz-progress-percent');
        const cTxt = document.getElementById('juz-completed-count');
        const pct = Math.round((completedCount / 30) * 100);

        if(pBar) pBar.style.width = `${pct}%`;
        if(pTxt) pTxt.innerText = `${pct}%`;
        if(cTxt) cTxt.innerText = completedCount;
        
        lucide.createIcons(); 
        updateMonthlyUI(); 
    }
    
    function generateDailyReport() { const c=document.getElementById('daily-log-container'); if(!c) return; c.innerHTML=''; const f=document.getElementById('report-day-filter').value; for(let i=1;i<=30;i++){ if(f!=='all' && parseInt(f)!==i) continue; const h=state.dailyHabits[`day${i}`]||JSON.parse(JSON.stringify(templateHabits)); const dc=h.filter(x=>x.done).length; const p=Math.round((dc/h.length)*100); const card=document.createElement('div'); card.className='glass-card p-5 mb-4 border border-white/5'; const l=h.filter(x=>x.category==='Shalat Wajib').map(x=>`<div class="report-log-item text-white flex flex-col items-center gap-1"><div class="w-8 h-8 rounded-full flex items-center justify-center ${x.done?'bg-emerald-900/40 text-emerald-400 border border-emerald-500/30':'bg-slate-800 text-slate-500 border border-slate-700'}">${x.done?'âœ”ï¸':'âŒ'}</div><span class="text-[9px] font-bold text-slate-400 uppercase">${x.name.substring(0,3)}</span></div>`).join(''); card.innerHTML=`<div class="flex justify-between items-center mb-4 pb-2 border-b border-white/10 text-white"><p class="text-xs font-black text-purple-400 uppercase tracking-widest">${i} RAMADHAN</p><span class="text-xs font-black text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded-lg">${p}% Tuntas</span></div><div class="report-log-grid">${l}</div>`; c.appendChild(card); } lucide.createIcons(); }
    
    // --- EVENT HANDLERS ---
    function changeActiveDay(day) { state.activeDay=parseInt(day); localStorage.setItem('ram_active_day', state.activeDay); renderHabits(); renderJournal(); updateUI(); updateDate(); }
    
    function updateUI() { 
        updateMonthlyUI(); 
        if(!state.dailyHabits[`day${state.activeDay}`]) state.dailyHabits[`day${state.activeDay}`]=JSON.parse(JSON.stringify(templateHabits)); 
        const h=state.dailyHabits[`day${state.activeDay}`]; 
        
        const statWajib = document.getElementById('stat-wajib'); if (statWajib) statWajib.innerText=`${h.filter(x=>x.category==='Shalat Wajib'&&x.done).length}/5`; 
        const barWajib = document.getElementById('bar-wajib'); if (barWajib) barWajib.style.width=(h.filter(x=>x.category==='Shalat Wajib'&&x.done).length/5*100)+'%'; 
        
        const ss=h.filter(x=>x.category==='Sholat Sunnah'&&x.done).length; 
        const statSunnah = document.getElementById('stat-sunnah'); if (statSunnah) statSunnah.innerText=`${ss}/5`; 
        const barSunnah = document.getElementById('bar-sunnah'); if (barSunnah) barSunnah.style.width=(ss/5*100)+'%'; 
        
        const rc=h.filter(x=>x.category==='Ramadhan Challenger'&&x.done).length; 
        const statChall = document.getElementById('stat-challenger'); if (statChall) statChall.innerText=`${rc}/5`; 
        const barChall = document.getElementById('bar-challenger'); if (barChall) barChall.style.width=(rc/5*100)+'%'; 
        
        if(document.getElementById('user-name-display')) document.getElementById('user-name-display').innerText=state.profile.displayName.split(' ')[0]; 
        if(document.getElementById('profile-display-name-val')) document.getElementById('profile-display-name-val').innerText=state.profile.displayName; 
        
        // Update mood buttons safely
        const dayJournal = state.journals[`day${state.activeDay}`];
        document.querySelectorAll('.mood-btn').forEach(btn => {
            if (dayJournal && dayJournal.mood) {
                btn.classList.toggle('active', dayJournal.mood === btn.id.split('-')[1]);
            } else {
                btn.classList.remove('active');
            }
        });
    }

    function updateDate() { const mD=document.getElementById('header-masehi-date'), hD=document.getElementById('header-hijri-date'), cD=document.getElementById('card-hijri-display'); const now=new Date(); const ds=now.toLocaleDateString('id-ID',{weekday:'long',day:'numeric',month:'long',year:'numeric'}).toUpperCase(); if(mD) mD.innerText=ds; if(hD) hD.innerText=`${state.activeDay} RAMADHAN 1447 H`; if(cD) cD.innerText=`${state.activeDay} RAMADHAN 1447 H`; const q=document.getElementById('daily-inspiration-text'); if(q) q.innerText=`"${ramadhanQuotes[(state.activeDay-1)%30]}"`; }
    
    function updateMonthlyUI() { 
        let dC=0; state.quranLog.forEach(d=>d.forEach(p=>{if(p)dC++})); const dp=Math.round((dC/150)*604), sisa=604-dp, pc=Math.min(Math.round((dC/150)*100),100); 
        const cE=document.getElementById('total-page-count'), pE=document.getElementById('total-page-percent'), bE=document.getElementById('total-page-bar'), rsE=document.getElementById('remaining-pages-label'), sE=document.getElementById('stat-khatam'), sbE=document.getElementById('bar-khatam'); 
        if(cE) cE.innerText=dp; 
        if(pE) pE.innerText=pc+'%'; 
        if(bE) bE.style.width=pc+'%'; 
        if(rsE) rsE.innerText=`SISA ${sisa} Hal`; 
        if(sE) sE.innerText=`${dp}/604`; 
        if(sbE) sbE.style.width=pc+'%'; 

        // Update Restored Stats in Monthly Report
        let pD = 0, eS = 0;
        for(let i=1; i<=30; i++){ const h = state.dailyHabits[`day${i}`]; if(h && h.filter(x=>x.done).length > 0){ pD++; eS += (h.filter(x=>x.done).length/h.length); } }
        let qD = 0; state.quranLog.forEach(d=>d.forEach(p=>{ if(p) qD++; }));
        
        const statTotalPuasa = document.getElementById('stat-total-puasa');
        if (statTotalPuasa) statTotalPuasa.innerText = pD;
        
        const statTotalKhatam = document.getElementById('stat-total-khatam');
        if (statTotalKhatam) statTotalKhatam.innerText = Math.min(Math.round((qD/150)*100), 100) + '%';
        
        const statAvgEff = document.getElementById('stat-avg-eff');
        if (statAvgEff) statAvgEff.innerText = (pD > 0 ? Math.round((eS/pD)*100) : 0) + '%';
        
        const statGoalsDone = document.getElementById('stat-goals-done');
        if (statGoalsDone) statGoalsDone.innerText = state.goals.filter(g => g.current >= g.target).length;
    }
    
    function toggleQuranLog(d, p) { state.quranLog[d][p]=!state.quranLog[d][p]; saveDailyData(); renderMonthlyTable(); updateMonthlyUI(); }
    function toggleJuz(idx) { state.juzLog[idx]=!state.juzLog[idx]; saveDailyData(); renderJuzList(); }
    function resetJuzProgress() { Swal.fire({title:'Reset Progress Juz?', text:"Data akan dihapus permanen.", icon:'warning', showCancelButton:true, background:'#020617', color:'#fff', confirmButtonColor:'#d33', cancelButtonColor:'#334155', confirmButtonText:'Ya, Reset!'}).then(r=>{if(r.isConfirmed){state.juzLog=Array(30).fill(false);saveDailyData();renderJuzList();Swal.fire({title:'Berhasil Direset!',icon:'success',background:'#020617',color:'#fff',confirmButtonColor:'#a855f7',timer:1500,showConfirmButton:false});}}); }
    function resetPageProgress() { Swal.fire({title:'Reset Progress Halaman?', text:"Data akan dihapus permanen.", icon:'warning', showCancelButton:true, background:'#020617', color:'#fff', confirmButtonColor:'#d33', cancelButtonColor:'#334155', confirmButtonText:'Ya, Reset!'}).then(r=>{if(r.isConfirmed){state.quranLog=Array(30).fill(null).map(()=>Array(5).fill(false));saveDailyData();renderMonthlyTable();Swal.fire({title:'Berhasil Direset!',icon:'success',background:'#020617',color:'#fff',confirmButtonColor:'#a855f7',timer:1500,showConfirmButton:false});}}); }
    function setMood(m) { if(!state.journals[`day${state.activeDay}`]) state.journals[`day${state.activeDay}`]={mood:'',text:''}; state.journals[`day${state.activeDay}`].mood=m; saveDailyData(); updateUI(); }
    function saveJournalEntry() { const t=document.getElementById('journal-input').value; if(!state.journals[`day${state.activeDay}`]) state.journals[`day${state.activeDay}`]={mood:'',text:''}; state.journals[`day${state.activeDay}`].text=t; saveDailyData(); Swal.fire({icon:'success',title:'Tersimpan',timer:1000,showConfirmButton:false, background:'#020617', color:'#fff'}); }
    function checkSettingsChange() { document.getElementById('btn-save-settings').disabled=false; }
    function saveAllSettings() { const n=document.getElementById('pref-name').value; if(n){state.profile.displayName=n;saveDailyData();updateUI();Swal.fire({title:'Profil Diperbarui!', icon:'success', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7', timer:1500, showConfirmButton:false});} }

    function handleQuranPlannerSlider(val) { updateQuranPlanner(val); }
    function updateQuranPlanner(t) { state.khatamTarget=parseInt(t); const total=604*t, pD=Math.ceil(total/30), pP=Math.ceil(pD/5); const tv=document.getElementById('khatam-target-val'); if(tv) tv.innerText=`${t} Kali`; const td=document.getElementById('target-pages-day'); if(td) td.innerText=`${pD} Halaman`; const tp=document.getElementById('target-pages-prayer'); if(tp) tp.innerText=`${pP} Halaman`; updateMonthlyUI(); }
    function switchQuranTab(tab) { ['juz','page','manual'].forEach(t => { document.getElementById(`view-quran-${t}`).classList.toggle('hidden', t!==tab); const btn=document.getElementById(`btn-quran-${t}`); if(btn) btn.classList.toggle('active', t===tab); }); if(tab==='manual') renderManualLog(); }
    function switchDuaTab(tab) { ['doa','niat','fiqih'].forEach(t => { document.getElementById(`view-dua-${t}`).classList.toggle('hidden', t!==tab); const btn=document.getElementById(`btn-dua-${t}`); if(btn) btn.classList.toggle('active', t===tab); }); }
    
    function switchReportView(v) { 
        document.getElementById('report-harian-view').classList.toggle('hidden', v!=='harian'); 
        document.getElementById('report-bulanan-view').classList.toggle('hidden', v!=='bulanan'); 
        
        const btnHarian = document.getElementById('btn-view-harian');
        const btnBulanan = document.getElementById('btn-view-bulanan');
        
        if (btnHarian) btnHarian.classList.toggle('active', v==='harian');
        if (btnBulanan) btnBulanan.classList.toggle('active', v==='bulanan');
        
        if(v==='bulanan'){ 
            setTimeout(initMonthlyTrendChart,100); 
            updateMonthlyUI(); // Force update stats when switching to monthly view
        } else { 
            setTimeout(initDailyChart,100); 
            generateDailyReport(); 
        } 
    }
    function handleReportFilterChange(val) { generateDailyReport(); }
    function initDailyChart() { const ctx=document.getElementById('dailyChart'); if(!ctx)return; if(dailyChart) dailyChart.destroy(); dailyChart=new Chart(ctx.getContext('2d'),{type:'line',data:{labels:['Min','Sen','Sel','Rab','Kam','Jum','Sab'],datasets:[{label:'Efisiensi',data:state.chartValues,borderColor:'#a855f7',backgroundColor:'rgba(168,85,247,0.1)',fill:true,tension:0.4}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{display:false,min:0,max:100},x:{grid:{display:false},ticks:{color:'#94a3b8',font:{size:10}}}}}}); }
    function initMonthlyTrendChart() { const ctx=document.getElementById('monthlyTrendChart'); if(!ctx)return; if(monthlyTrendChart) monthlyTrendChart.destroy(); const l=Array.from({length:30},(_,i)=>i+1); const d=l.map(day=>{const h=state.dailyHabits[`day${day}`]||templateHabits;return Math.round((h.filter(x=>x.done).length/h.length)*100)}); monthlyTrendChart=new Chart(ctx.getContext('2d'),{type:'line',data:{labels:l,datasets:[{label:'Efisiensi',data:d,borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.1)',fill:true,tension:0.3,pointRadius:2}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{display:false,min:0,max:100},x:{grid:{display:false},ticks:{color:'#94a3b8',font:{size:8}}}}}}); }
    
    function toggleAdzanModal(show) { const m=document.getElementById('modal-adzan-settings'); if(show){m.classList.add('active');renderAdzanSettings();}else{m.classList.remove('active');} }
    function switchAdzanTab(m) { state.adzanSettings.mode=m; saveDailyData(); renderAdzanSettings(); }
    function toggleAdzanActive(p) { state.adzanSettings.active[p]=!state.adzanSettings.active[p]; saveDailyData(); renderAdzanSettings(); }
    function renderAdzanSettings() { const m=state.adzanSettings.mode; const b1=document.getElementById('tab-adzan-beep'); const b2=document.getElementById('tab-adzan-full'); if(m==='beep'){b1.className='flex-1 py-2 text-xs font-bold rounded-lg text-white bg-purple-600 transition-all';b2.className='flex-1 py-2 text-xs font-bold rounded-lg text-slate-400 hover:text-white transition-all';}else{b2.className='flex-1 py-2 text-xs font-bold rounded-lg text-white bg-purple-600 transition-all';b1.className='flex-1 py-2 text-xs font-bold rounded-lg text-slate-400 hover:text-white transition-all';} const c=document.getElementById('adzan-toggle-list'); c.innerHTML=''; const lbl={'Fajr':'Subuh','Dhuhr':'Dzhur','Asr':'Ashar','Maghrib':'Maghrib','Isha':'Isya'}; ['Fajr','Dhuhr','Asr','Maghrib','Isha'].forEach(p=>{ const div=document.createElement('div'); div.className='flex justify-between items-center bg-slate-800/50 p-3 rounded-xl border border-white/5'; div.innerHTML=`<span class="text-sm font-bold text-white">${lbl[p]}</span><div onclick="toggleAdzanActive('${p}')" class="adzan-toggle ${state.adzanSettings.active[p]?'active':''}"></div>`; c.appendChild(div); }); }
    
    function addNewGoal() { Swal.fire({title:'Tambah Target Baru', html:'<input id="sw-gt" class="swal2-input" placeholder="Judul"><input id="sw-gs" class="swal2-input" placeholder="Target Angka"><input id="sw-gu" class="swal2-input" placeholder="Satuan (hal/juz/kali)">', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7', cancelButtonColor:'#334155', showCancelButton:true, preConfirm:()=>{return{title:document.getElementById('sw-gt').value,target:parseInt(document.getElementById('sw-gs').value),unit:document.getElementById('sw-gu').value,current:0}}}).then(r=>{if(r.isConfirmed && r.value.title && r.value.target){state.goals.push(r.value);saveDailyData();renderGoals();Swal.fire({title:'Target Ditambahkan!',icon:'success',background:'#020617',color:'#fff',confirmButtonColor:'#a855f7',timer:1500,showConfirmButton:false});}}); }
    function editGoal(i) { const g=state.goals[i]; Swal.fire({title:'Edit Target', html:`<input id="e-gt" class="swal2-input" value="${g.title}"><input id="e-gs" class="swal2-input" value="${g.target}"><input id="e-gu" class="swal2-input" value="${g.unit}">`, background:'#020617', color:'#fff', confirmButtonColor:'#a855f7', cancelButtonColor:'#334155', showCancelButton:true, preConfirm:()=>{return{title:document.getElementById('e-gt').value,target:parseInt(document.getElementById('e-gs').value),unit:document.getElementById('e-gu').value,current:g.current}}}).then(r=>{if(r.isConfirmed){state.goals[i]=r.value;saveDailyData();renderGoals();Swal.fire({title:'Target Diperbarui!',icon:'success',background:'#020617',color:'#fff',confirmButtonColor:'#a855f7',timer:1500,showConfirmButton:false});}}); }
    function updateGoalProgress(i,v) { state.goals[i].current=Math.max(0,state.goals[i].current+v); saveDailyData(); renderGoals(); }
    function deleteGoal(i) { Swal.fire({title:'Hapus Target?', text:"Tidak bisa dikembalikan.", icon:'warning', showCancelButton:true, background:'#020617', color:'#fff', confirmButtonColor:'#d33', cancelButtonColor:'#334155', confirmButtonText:'Ya, Hapus!'}).then(r=>{if(r.isConfirmed){state.goals.splice(i,1);saveDailyData();renderGoals();Swal.fire({title:'Target Dihapus!',icon:'success',background:'#020617',color:'#fff',confirmButtonColor:'#a855f7',timer:1500,showConfirmButton:false});}}); }
    
    function populateSurahDropdowns() { const s1=document.getElementById('manual-surah-start'), s2=document.getElementById('manual-surah-end'); if(!s1||!s2)return; s1.innerHTML='<option value="" disabled selected>Pilih Surat Awal</option>'; s2.innerHTML='<option value="" disabled selected>Pilih Surat Akhir</option>'; SURAH_LIST.forEach((s,i)=>{ const o1=document.createElement('option'); o1.value=s; o1.text=`${i+1}. ${s}`; s1.appendChild(o1); const o2=document.createElement('option'); o2.value=s; o2.text=`${i+1}. ${s}`; s2.appendChild(o2); }); }
    function saveManualEntry() { const s1=document.getElementById('manual-surah-start').value, a1=document.getElementById('manual-ayat-start').value, s2=document.getElementById('manual-surah-end').value, a2=document.getElementById('manual-ayat-end').value; if(!s1||!a1||!s2||!a2){Swal.fire({title:'Info',text:'Lengkapi data',icon:'warning', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'});return;} const e={id:Date.now(),startSurah:s1,startAyat:a1,endSurah:s2,endAyat:a2,timestamp:new Date().toLocaleString()}; state.manualLog.unshift(e); saveDailyData(); renderManualLog(); Swal.fire({icon:'success',title:'Disimpan',timer:800,showConfirmButton:false, background:'#020617', color:'#fff'}); }
    function deleteManualEntry(id) { state.manualLog=state.manualLog.filter(x=>x.id!==id); saveDailyData(); renderManualLog(); }
    function resetManualLog() { Swal.fire({title:'Hapus Semua Catatan?', text:"Riwayat bacaan akan hilang.", icon:'warning', showCancelButton:true, background:'#020617', color:'#fff', confirmButtonColor:'#d33', cancelButtonColor:'#334155', confirmButtonText:'Ya, Hapus!'}).then(r=>{if(r.isConfirmed){state.manualLog=[];saveDailyData();renderManualLog();Swal.fire({title:'Berhasil Dihapus!',icon:'success',background:'#020617',color:'#fff',confirmButtonColor:'#a855f7',timer:1500,showConfirmButton:false});}}); }
    
    function toggleAuthMode() { state.authMode = state.authMode==='login'?'register':'login'; const c=document.getElementById('field-name-container'), btn=document.getElementById('btn-text'), sw=document.getElementById('auth-switch-btn'), ft=document.getElementById('auth-footer-text'); if(state.authMode==='register'){c.classList.remove('hidden');setTimeout(()=>c.classList.remove('opacity-0'),50);btn.innerText="DAFTAR SEKARANG";ft.innerText="Sudah punya akun?";sw.innerText="Masuk Sekarang";}else{c.classList.add('opacity-0');setTimeout(()=>c.classList.add('hidden'),300);btn.innerText="MASUK SEKARANG";ft.innerText="Belum punya akun?";sw.innerText="Daftar Akun Baru";} }
    function handleAuthAction() { const btn=document.getElementById('btn-auth-action'), txt=document.getElementById('btn-text'); btn.disabled=true; txt.innerText="Memuat..."; btn.classList.add('opacity-70'); setTimeout(()=>{if(state.authMode==='login') doLogin(); else doRegister();},800); }
    function doRegister() { const n=document.getElementById('auth-name').value.trim(), e=document.getElementById('auth-email').value.trim(), p=document.getElementById('auth-pass').value.trim(); if(!n||!e||!p){Swal.fire({icon:'warning',title:'Data kurang', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'});resetBtn();return;} const db=JSON.parse(localStorage.getItem('khodim_users_db')||'[]'); if(db.some(u=>u.email===e)){Swal.fire({icon:'error',title:'Email terdaftar', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'});resetBtn();return;} const u={name:n.split(' ')[0],fullName:n,email:e,password:p}; db.push(u); localStorage.setItem('khodim_users_db',JSON.stringify(db)); localStorage.setItem('khodim_pending_reg',JSON.stringify(u)); state.user={name:u.name,email:u.email}; state.profile.displayName=u.fullName; localStorage.setItem('khodim_active_session',JSON.stringify(state.user)); saveDailyData(); Swal.fire({icon:'success',title:'Berhasil',showConfirmButton:false,timer:1500, background:'#020617', color:'#fff'}).then(()=>showApp()); }
    function doLogin() { const e=document.getElementById('auth-email').value.trim(), p=document.getElementById('auth-pass').value.trim(); if(!e||!p){Swal.fire({icon:'info',title:'Data kurang', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'});resetBtn();return;} const db=JSON.parse(localStorage.getItem('khodim_users_db')||'[]'); const u=db.find(x=>x.email===e && x.password===p); if(u){ state.user={name:u.name,email:u.email}; state.profile.displayName=u.fullName; localStorage.setItem('khodim_active_session',JSON.stringify(state.user)); saveDailyData(); Swal.fire({icon:'success',title:'Berhasil',showConfirmButton:false,timer:1500, background:'#020617', color:'#fff'}).then(()=>showApp()); localStorage.setItem('khodim_pending_login',JSON.stringify({email:u.email,status:'Success'})); setTimeout(runBackgroundSystem,500); } else { Swal.fire({icon:'error',title:'Akun tidak ditemukan', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}); resetBtn(); } }
    function resetBtn() { const btn=document.getElementById('btn-auth-action'), txt=document.getElementById('btn-text'); btn.disabled=false; txt.innerText=state.authMode==='login'?"MASUK SEKARANG":"DAFTAR SEKARANG"; btn.classList.remove('opacity-70'); }
    function doLogout() { localStorage.removeItem('khodim_active_session'); location.reload(); }
    function togglePasswordVisibility(id, btn) { const i=document.getElementById(id); if(i.type==='password'){i.type='text';btn.innerHTML='<i data-lucide="eye-off" class="w-5 h-5"></i>';}else{i.type='password';btn.innerHTML='<i data-lucide="eye" class="w-5 h-5"></i>';} lucide.createIcons(); }
    
    function generateShareCard(type) {
        document.getElementById('sc-user-name').innerText=state.profile.displayName;
        document.getElementById('sc-quote').innerText=ramadhanQuotes[(state.activeDay-1)%30];
        const list=document.getElementById('sc-activity-list'); list.innerHTML='';
        
        if(type==='daily') {
            document.getElementById('sc-date-label').innerText="DAILY REPORT";
            document.getElementById('sc-main-title').innerHTML=`Hari Ke-${state.activeDay}<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-emerald-400">Ramadhan</span>`;
            const h=state.dailyHabits[`day${state.activeDay}`]||templateHabits;
            const wc=h.filter(x=>x.category==='Shalat Wajib'&&x.done).length;
            const sc=h.filter(x=>x.category==='Sholat Sunnah'&&x.done).length;
            const cc=h.filter(x=>x.category==='Ramadhan Challenger'&&x.done).length;
            addShareListItem(list, 'Shalat Wajib', `${wc}/5`, wc===5);
            addShareListItem(list, 'Shalat Sunnah', `${sc} Amalan`, sc>0);
            addShareListItem(list, 'Ramadhan Goals', `${cc} Selesai`, cc>0);
            document.getElementById('sc-quran-status').innerText=getQuranProgressText(state.activeDay);
        } else {
            document.getElementById('sc-date-label').innerText="FULL RECAP";
            document.getElementById('sc-main-title').innerHTML=`Ramadhan<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-purple-400">Summary</span>`;
            let tp=0, ts=0; for(let i=1;i<=30;i++){ const d=state.dailyHabits[`day${i}`]; if(d && d.some(x=>x.category==='Shalat Wajib'&&x.done)) tp++; if(d) ts+=d.filter(x=>x.category==='Sholat Sunnah'&&x.done).length; }
            addShareListItem(list, 'Total Hari Aktif', `${tp} Hari`, true);
            addShareListItem(list, 'Total Sunnah', `${ts} Kali`, true);
            let qText="Belum Ada Data"; const jd=state.juzLog.filter(x=>x).length;
            if(jd>0) qText=`${jd} Juz Khatam`; else { let pc=0; state.quranLog.forEach(d=>d.forEach(p=>{if(p)pc++})); qText=`${pc} Halaman`; }
            document.getElementById('sc-quran-status').innerText=qText;
        }
        
        const gList=document.getElementById('sc-goals-list'), gSec=document.getElementById('sc-goals-section'); gList.innerHTML='';
        if(state.goals.length>0){
            gSec.classList.remove('hidden');
            state.goals.slice(0,3).forEach(g=>{
                const p=Math.min(Math.round((g.current/g.target)*100),100);
                gList.innerHTML+=`<div class="flex justify-between text-[10px] mb-1"><span class="text-slate-300 font-bold">${g.title}</span><span class="text-emerald-400 font-bold">${p}%</span></div><div class="w-full bg-black/20 h-1.5 rounded-full overflow-hidden"><div class="bg-gradient-to-r from-blue-500 to-emerald-400 h-full" style="width: ${p}%"></div></div>`;
            });
        } else { gSec.classList.add('hidden'); }
        
        const el=document.getElementById('share-card-template');
        Swal.fire({title:'Memproses...',didOpen:()=>{Swal.showLoading()}, background:'#020617', color:'#fff'});
        html2canvas(el,{scale:2,backgroundColor:null}).then(c=>{
            Swal.close();
            Swal.fire({title:'Rapor Siap!',imageUrl:c.toDataURL("image/png"),imageAlt:'Rapor',showConfirmButton:true,confirmButtonText:'Tutup',background:'#020617',color:'#fff', confirmButtonColor:'#a855f7'});
        }).catch(e=>Swal.fire({title:'Gagal',text:''+e,icon:'error', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}));
    }
    
    function addShareListItem(c, l, v, g) { c.innerHTML+=`<div class="sc-check-row"><span class="sc-check-label">${l}</span><div class="flex items-center gap-1.5"><span class="text-[10px] font-bold ${g?'text-white':'text-slate-500'}">${v}</span><div class="w-4 h-4 rounded-full flex items-center justify-center ${g?'bg-emerald-500 text-white':'bg-slate-700 text-slate-500'}"><span class="sc-check-icon">âœ“</span></div></div></div>`; }
    function getQuranProgressText(d) {
        if(state.manualLog.length>0 && new Date(state.manualLog[0].id).getDate()===new Date().getDate()) return `${state.manualLog[0].endSurah}:${state.manualLog[0].endAyat}`;
        if(state.juzLog[d-1]) return `Juz ${d} Selesai`;
        const p=state.quranLog[d-1]?.filter(x=>x).length||0; if(p>0) return `${p} Halaman Tuntas`;
        return "Belum Ada Bacaan";
    }

    // --- OTHER ---
    function fetchPrayerTimesCity(c) { fetch(`https://api.aladhan.com/v1/timingsByCity?city=${c}&country=Indonesia&method=11`).then(r=>r.json()).then(d=>{state.prayerTimes=d.data.timings; updatePTUI(); document.getElementById('current-location-display').innerText=c; updateSmartSuhoor(state.prayerTimes.Fajr);}); }
    function fetchPrayerTimes(lat,lon) { fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=11`).then(r=>r.json()).then(d=>{state.prayerTimes=d.data.timings; updatePTUI(); fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`).then(r=>r.json()).then(l=>{document.getElementById('current-location-display').innerText=l.address.city||l.address.town||"Lokasi";}); updateSmartSuhoor(state.prayerTimes.Fajr);}); }
    function updatePTUI() { if(!state.prayerTimes)return; ['Fajr','Dhuhr','Asr','Maghrib','Isha'].forEach(p=>{document.getElementById(`time-${p==='Dhuhr'?'dhuhr-val':p.toLowerCase()}`).innerText=state.prayerTimes[p];}); initCountdown(); }
    function detectLocation() { if(navigator.geolocation) navigator.geolocation.getCurrentPosition(p=>fetchPrayerTimes(p.coords.latitude,p.coords.longitude), ()=>fetchPrayerTimesCity("Jakarta")); else fetchPrayerTimesCity("Jakarta"); }
    function updateSmartSuhoor(t) { if(!t)return; const [h,m]=t.split(':').map(Number); const d=new Date(); d.setHours(h,m,0,0); const best=new Date(d.getTime()-45*60000), imsak=new Date(d.getTime()-10*60000); const f=x=>x.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'}); document.getElementById('smart-suhoor-text').innerHTML=`Sahur: <span class="text-emerald-400">${f(best)}</span> - <span class="text-purple-400">${f(imsak)}</span>`; }
    function initCountdown() { setInterval(()=>{ if(!state.prayerTimes)return; const now=new Date(); const iftar=parseTimeStr(state.prayerTimes.Maghrib), imsak=parseTimeStr(state.prayerTimes.Fajr); if(!iftar||!imsak)return; let t,l; if(now>imsak && now<iftar){t=iftar;l="MENUJU BUKA PUASA";}else{l="MENUJU IMSAK";t=(now>iftar)?new Date(imsak.getTime()+86400000):imsak;} const d=t-now; if(d>0){const h=Math.floor(d/3600000),m=Math.floor((d%3600000)/60000),s=Math.floor((d%60000)/1000); document.getElementById('countdown-label').innerText=l; document.getElementById('countdown-timer').innerText=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;} },1000); }
    function runBackgroundSystem() { if(state.gsUrl && localStorage.getItem('khodim_pending_reg')){ fetch(state.gsUrl,{method:'POST',body:JSON.stringify({action:'register_backup',data:{userDB:JSON.parse(localStorage.getItem('khodim_pending_reg'))}})}).then(r=>r.json()).then(d=>{if(d.status==='success')localStorage.removeItem('khodim_pending_reg')}); } }
    function saveCloudUrl() { const u=document.getElementById('cfg-gs-url').value; state.gsUrl=u; localStorage.setItem('khodim_gs_url',u); Swal.fire({title:'Tersimpan', icon:'success', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}); }
    function copyBackendScript() { const t=document.createElement("textarea"); t.value=BACKEND_SCRIPT_CODE; document.body.appendChild(t); t.select(); document.execCommand('copy'); document.body.removeChild(t); Swal.fire({title:'Tersalin', icon:'success', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}); }
    function testGASConnection() { if(!state.gsUrl)return Swal.fire({title:'URL Kosong', icon:'warning', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}); fetch(state.gsUrl,{method:'POST',body:JSON.stringify({action:'ping'})}).then(r=>r.json()).then(d=>{if(d.status==='success')Swal.fire({title:'Terkoneksi', icon:'success', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'});else Swal.fire({title:'Gagal',text:d.message,icon:'error', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'})}).catch(e=>Swal.fire({title:'Error',text:''+e,icon:'error', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'})); }
    async function syncToCloud() { if(!state.gsUrl)return Swal.fire({title:'URL Kosong', icon:'warning', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}); Swal.fire({title:'Upload...',didOpen:()=>Swal.showLoading(), background:'#020617', color:'#fff'}); try{ await fetch(state.gsUrl,{method:'POST',body:JSON.stringify({action:'save_data',user_id:state.user.name,data:state})}); Swal.fire({title:'Berhasil', icon:'success', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}); }catch(e){Swal.fire({title:'Error',text:''+e,icon:'error', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'});} }
    async function syncFromCloud() { if(!state.gsUrl)return Swal.fire({title:'URL Kosong', icon:'warning', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}); Swal.fire({title:'Download...',didOpen:()=>Swal.showLoading(), background:'#020617', color:'#fff'}); try{ const r=await fetch(state.gsUrl,{method:'POST',body:JSON.stringify({action:'load_data',user_id:state.user.name})}); const d=await r.json(); if(d.status==='success' && d.data) { Object.assign(state, d.data); saveDailyData(); updateUI(); Swal.fire({title:'Berhasil', icon:'success', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}); } else Swal.fire({title:'Info',text:'Data kosong',icon:'info', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'}); }catch(e){Swal.fire({title:'Error',text:''+e,icon:'error', background:'#020617', color:'#fff', confirmButtonColor:'#a855f7'});} }
    function changeAvatar() { document.getElementById('avatar-upload-input').click(); }
    function handleImageUpload(e) { const f=e.target.files[0]; if(f){ const r=new FileReader(); r.onload=(ev)=>{state.profile.avatar=ev.target.result; document.getElementById('user-avatar').src=ev.target.result; saveDailyData();}; r.readAsDataURL(f); } }
    
    window.onload = () => { lucide.createIcons(); initUser(); };
  </script>
</body>
</html>